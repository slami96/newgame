[source: 1] <!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enhanced Brick Breaker</title>
    <style>
        body {
            margin: 0; /* [cite: 2] */
            padding: 0; /* [cite: 3] */
            display: flex; /* [cite: 4] */
            justify-content: center; /* [cite: 5] */
            align-items: center; /* [cite: 6] */
            height: 100vh; /* [cite: 7] */
            background-color: #0a0a2a; /* [cite: 8] */
            font-family: 'Arial', sans-serif; /* [cite: 9] */
            overflow: hidden; /* [cite: 10] */
            color: white; /* [cite: 11] */
        } /* [cite: 11] */
        #game-container {
            position: relative; /* [cite: 12] */
            width: 800px; /* [cite: 13] */
            height: 600px; /* [cite: 14] */
        } /* [cite: 14] */
        canvas {
            background-color: #111133; /* [cite: 15] */
            box-shadow: 0 0 20px rgba(0, 0, 255, 0.5); /* [cite: 16] */
            border-radius: 10px; /* [cite: 17] */
        } /* [cite: 17] */
        #score {
            position: absolute; /* [cite: 18] */
            top: 20px; /* [cite: 19] */
            left: 20px; /* [cite: 20] */
            color: white; /* [cite: 21] */
            font-size: 24px; /* [cite: 22] */
            font-weight: bold; /* [cite: 23] */
            text-shadow: 0 0 5px #00ffff; /* [cite: 24] */
        } /* [cite: 24] */
        #lives {
            position: absolute; /* [cite: 25] */
            top: 20px; /* [cite: 26] */
            right: 20px; /* [cite: 27] */
            color: white; /* [cite: 28] */
            font-size: 24px; /* [cite: 29] */
            font-weight: bold; /* [cite: 30] */
            text-shadow: 0 0 5px #ff00ff; /* [cite: 31] */
        } /* [cite: 31] */
        #combo-display {
            position: absolute; /* [cite: 32] */
            top: 60px; /* [cite: 33] */
            left: 20px; /* [cite: 34] */
            color: #ffaa00; /* [cite: 35] */
            font-size: 20px; /* [cite: 36] */
            font-weight: bold; /* [cite: 37] */
            text-shadow: 0 0 5px #ff7700; /* [cite: 38] */
            opacity: 0; /* [cite: 39] */
            transition: opacity 0.3s; /* [cite: 40] */
        } /* [cite: 40] */
        #level-display {
            position: absolute; /* [cite: 41] */
            top: 20px; /* [cite: 42] */
            left: 50%; /* [cite: 43] */
            transform: translateX(-50%); /* [cite: 44] */
            color: white; /* [cite: 45] */
            font-size: 24px; /* [cite: 46] */
            font-weight: bold; /* [cite: 47] */
            text-shadow: 0 0 5px #00ffff; /* [cite: 48] */
        } /* [cite: 48] */
        #game-over, #level-complete {
            position: absolute; /* [cite: 49] */
            top: 0; /* [cite: 50] */
            left: 0; /* [cite: 51] */
            width: 100%; /* [cite: 52] */
            height: 100%; /* [cite: 53] */
            display: flex; /* [cite: 54] */
            flex-direction: column; /* [cite: 55] */
            justify-content: center; /* [cite: 56] */
            align-items: center; /* [cite: 57] */
            background-color: rgba(0, 0, 0, 0.8); /* [cite: 58] */
            color: white; /* [cite: 59] */
            font-size: 36px; /* [cite: 60] */
            display: none; /* [cite: 61] */
            border-radius: 10px; /* [cite: 62] */
            text-align: center; /* [cite: 63] */
        } /* [cite: 63] */
        #game-over h2, #level-complete h2 {
            color: #ff5555; /* [cite: 64] */
            text-shadow: 0 0 10px #ff0000; /* [cite: 65] */
            margin-bottom: 10px; /* [cite: 66] */
        } /* [cite: 66] */
        #game-stats {
            margin: 20px 0; /* [cite: 67] */
            font-size: 24px; /* [cite: 68] */
            color: #aaffff; /* [cite: 69] */
        } /* [cite: 69] */
        button {
            padding: 15px 30px; /* [cite: 70] */
            font-size: 20px; /* [cite: 71] */
            background: linear-gradient(to bottom, #4444ff, #2222aa); /* [cite: 72] */
            color: white; /* [cite: 73] */
            border: none; /* [cite: 74] */
            border-radius: 5px; /* [cite: 75] */
            cursor: pointer; /* [cite: 76] */
            margin-top: 20px; /* [cite: 77] */
            box-shadow: 0 0 10px rgba(0, 255, 255, 0.5); /* [cite: 78] */
            transition: all 0.3s; /* [cite: 79] */
        } /* [cite: 79] */
        button:hover {
            background: linear-gradient(to bottom, #5555ff, #3333bb); /* [cite: 80] */
            transform: scale(1.05); /* [cite: 81] */
        } /* [cite: 81] */
        #start-screen {
            position: absolute; /* [cite: 82] */
            top: 0; /* [cite: 83] */
            left: 0; /* [cite: 84] */
            width: 100%; /* [cite: 85] */
            height: 100%; /* [cite: 86] */
            display: flex; /* [cite: 87] */
            flex-direction: column; /* [cite: 88] */
            justify-content: center; /* [cite: 89] */
            align-items: center; /* [cite: 90] */
            background-color: rgba(10, 10, 42, 0.9); /* [cite: 91] */
            color: white; /* [cite: 92] */
            border-radius: 10px; /* [cite: 93] */
            z-index: 100; /* [cite: 94] */
        } /* [cite: 94] */
        #start-screen h1 {
            font-size: 48px; /* [cite: 95] */
            margin-bottom: 30px; /* [cite: 96] */
            text-shadow: 0 0 15px #00ffff; /* [cite: 97] */
            animation: glow 2s infinite alternate; /* [cite: 98] */
        } /* [cite: 98] */
        @keyframes glow {
            from {
                text-shadow: 0 0 10px #00ffff; /* [cite: 99] */
            } /* [cite: 99] */
            to {
                text-shadow: 0 0 20px #00ffff, 0 0 30px #00ffff; /* [cite: 100] */
            } /* [cite: 100] */
        } /* [cite: 100] */
        #instructions {
            margin: 20px 0; /* [cite: 101] */
            text-align: center; /* [cite: 102] */
            max-width: 500px; /* [cite: 103] */
            line-height: 1.5; /* [cite: 104] */
        } /* [cite: 104] */
        #fps {
            position: absolute; /* [cite: 105] */
            bottom: 10px; /* [cite: 106] */
            right: 10px; /* [cite: 107] */
            color: rgba(255, 255, 255, 0.5); /* [cite: 108] */
            font-size: 12px; /* [cite: 109] */
        } /* [cite: 109] */
        #pause-indicator {
            position: absolute; /* [cite: 110] */
            top: 50%; /* [cite: 111] */
            left: 50%; /* [cite: 112] */
            transform: translate(-50%, -50%); /* [cite: 113] */
            color: white; /* [cite: 114] */
            font-size: 36px; /* [cite: 115] */
            background-color: rgba(0, 0, 0, 0.7); /* [cite: 116] */
            padding: 20px 40px; /* [cite: 117] */
            border-radius: 10px; /* [cite: 118] */
            display: none; /* [cite: 119] */
            z-index: 50; /* [cite: 120] */
        } /* [cite: 120] */
        #debug-panel {
            position: absolute; /* [cite: 121] */
            bottom: 10px; /* [cite: 122] */
            left: 10px; /* [cite: 123] */
            color: white; /* [cite: 124] */
            font-size: 12px; /* [cite: 125] */
            background-color: rgba(0, 0, 0, 0.5); /* [cite: 126] */
            padding: 5px; /* [cite: 127] */
            border-radius: 5px; /* [cite: 128] */
            max-width: 300px; /* [cite: 129] */
            display: none; /* [cite: 130] */
        } /* [cite: 130] */
        /* Theme selector */
        #theme-selector {
            position: absolute; /* [cite: 131] */
            top: 15px; /* [cite: 132] */
            left: 50%; /* [cite: 133] */
            transform: translateX(-50%); /* [cite: 134] */
            display: flex; /* [cite: 135] */
            gap: 10px; /* [cite: 136] */
            z-index: 110; /* [cite: 137] */
        } /* [cite: 137] */
        .theme-btn {
            width: 30px; /* [cite: 138] */
            height: 30px; /* [cite: 139] */
            border-radius: 50%; /* [cite: 140] */
            border: 2px solid white; /* [cite: 141] */
            cursor: pointer; /* [cite: 142] */
            transition: transform 0.2s; /* [cite: 143] */
        } /* [cite: 143] */
        .theme-btn:hover {
            transform: scale(1.2); /* [cite: 144] */
        } /* [cite: 144] */
        .theme-btn.active {
            border: 2px solid gold; /* [cite: 145] */
            box-shadow: 0 0 10px gold; /* [cite: 146] */
        } /* [cite: 146] */
        #standard-theme {
            background: linear-gradient(to bottom right, #0a0a2a, #191970); /* [cite: 147] */
        } /* [cite: 147] */
        #neon-theme {
            background: linear-gradient(to bottom right, #000, #440044); /* [cite: 148] */
        } /* [cite: 148] */
        #retro-theme {
            background: linear-gradient(to bottom right, #221, #442); /* [cite: 149] */
        } /* [cite: 149] */
        /* High Score display */
        #high-scores {
            position: absolute; /* [cite: 150] */
            top: 0; /* [cite: 151] */
            left: 0; /* [cite: 152] */
            width: 100%; /* [cite: 153] */
            height: 100%; /* [cite: 154] */
            display: flex; /* [cite: 155] */
            flex-direction: column; /* [cite: 156] */
            justify-content: center; /* [cite: 157] */
            align-items: center; /* [cite: 158] */
            background-color: rgba(0, 0, 0, 0.9); /* [cite: 159] */
            color: white; /* [cite: 160] */
            font-size: 24px; /* [cite: 161] */
            display: none; /* [cite: 162] */
            border-radius: 10px; /* [cite: 163] */
            z-index: 120; /* [cite: 164] */
        } /* [cite: 164] */
        #high-scores h2 {
            font-size: 36px; /* [cite: 165] */
            margin-bottom: 20px; /* [cite: 166] */
            text-shadow: 0 0 10px #00ffff; /* [cite: 167] */
        } /* [cite: 167] */
        #scores-list {
            width: 80%; /* [cite: 168] */
            margin-bottom: 30px; /* [cite: 169] */
        } /* [cite: 169] */
        .score-row {
            display: flex; /* [cite: 170] */
            justify-content: space-between; /* [cite: 171] */
            padding: 10px; /* [cite: 172] */
            border-bottom: 1px solid rgba(255, 255, 255, 0.2); /* [cite: 173] */
        } /* [cite: 173] */
        .score-row:nth-child(even) {
            background-color: rgba(255, 255, 255, 0.05); /* [cite: 174] */
        } /* [cite: 174] */
        /* Animated elements */
        @keyframes bounce {
            0%, 100% { transform: translateY(0); /* [cite: 175] */ }
            50% { transform: translateY(-20px); /* [cite: 176] */ }
        } /* [cite: 176] */
        @keyframes flash {
            0%, 100% { opacity: 1; /* [cite: 177] */ }
            50% { opacity: 0.5; /* [cite: 178] */ }
        } /* [cite: 178] */
        @keyframes shake {
            0%, 100% { transform: translateX(0); /* [cite: 179] */ }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); /* [cite: 180] */ }
            20%, 40%, 60%, 80% { transform: translateX(5px); /* [cite: 181] */ }
        } /* [cite: 181] */
        .shaking {
            animation: shake 0.5s; /* [cite: 182] */
        } /* [cite: 182] */
        /* Screen flash */
        #screen-flash {
            position: absolute; /* [cite: 183] */
            top: 0; /* [cite: 184] */
            left: 0; /* [cite: 185] */
            width: 100%; /* [cite: 186] */
            height: 100%; /* [cite: 187] */
            background-color: white; /* [cite: 188] */
            opacity: 0; /* [cite: 189] */
            pointer-events: none; /* [cite: 190] */
            border-radius: 10px; /* [cite: 191] */
            transition: opacity 0.1s; /* [cite: 192] */
        } /* [cite: 192] */
        /* Mobile controls */
        #mobile-controls {
            position: absolute; /* [cite: 193] */
            bottom: 0; /* [cite: 194] */
            left: 0; /* [cite: 195] */
            width: 100%; /* [cite: 196] */
            height: 80px; /* [cite: 197] */
            display: none; /* [cite: 198] */
            justify-content: space-between; /* [cite: 199] */
            align-items: center; /* [cite: 200] */
            z-index: 30; /* [cite: 201] */
        } /* [cite: 201] */
        .mobile-btn {
            width: 40%; /* [cite: 202] */
            height: 100%; /* [cite: 203] */
            background-color: rgba(255, 255, 255, 0.1); /* [cite: 204] */
            display: flex; /* [cite: 205] */
            justify-content: center; /* [cite: 206] */
            align-items: center; /* [cite: 207] */
            font-size: 24px; /* [cite: 208] */
            cursor: pointer; /* [cite: 209] */
            user-select: none; /* [cite: 210] */
        } /* [cite: 210] */
        #menu-btn {
            position: absolute; /* [cite: 211] */
            top: 20px; /* [cite: 212] */
            right: 20px; /* [cite: 213] */
            width: 40px; /* [cite: 214] */
            height: 40px; /* [cite: 215] */
            background-color: rgba(0, 0, 0, 0.5); /* [cite: 216] */
            border-radius: 50%; /* [cite: 217] */
            display: flex; /* [cite: 218] */
            justify-content: center; /* [cite: 219] */
            align-items: center; /* [cite: 220] */
            cursor: pointer; /* [cite: 221] */
            z-index: 110; /* [cite: 222] */
        } /* [cite: 222] */
        #menu-btn::before {
            content: "  ⚙️  "; /* [cite: 223] */
            font-size: 20px; /* [cite: 224] */
        } /* [cite: 224] */
        #game-menu {
            position: absolute; /* [cite: 225] */
            top: 70px; /* [cite: 226] */
            right: 20px; /* [cite: 227] */
            background-color: rgba(0, 0, 0, 0.8); /* [cite: 228] */
            border-radius: 10px; /* [cite: 229] */
            padding: 10px; /* [cite: 230] */
            display: none; /* [cite: 231] */
            z-index: 110; /* [cite: 232] */
        } /* [cite: 232] */
        .menu-item {
            padding: 10px; /* [cite: 233] */
            cursor: pointer; /* [cite: 234] */
            transition: background-color 0.2s; /* [cite: 235] */
        } /* [cite: 235] */
        .menu-item:hover {
            background-color: rgba(255, 255, 255, 0.1); /* [cite: 236] */
        } /* [cite: 236] */
        #name-input {
            padding: 10px; /* [cite: 237] */
            font-size: 18px; /* [cite: 238] */
            border-radius: 5px; /* [cite: 239] */
            border: none; /* [cite: 240] */
            margin: 10px 0; /* [cite: 241] */
            width: 250px; /* [cite: 242] */
            text-align: center; /* [cite: 243] */
        } /* [cite: 243] */
    </style>
</head>
<body>
    <div id="game-container">
        <canvas id="gameCanvas" width="800" height="600"></canvas>
        <div id="score">Score: 0</div>
        <div id="lives">Lives: 3</div>
        <div id="combo-display">Combo x1</div>
        <div id="level-display">Level 1</div>
        <div id="fps">FPS: 0</div>
        <div id="debug-panel"></div>

        <div id="screen-flash"></div> /* [cite: 244] */
        <div id="menu-btn"></div> <div id="game-menu">
            <div class="menu-item" id="toggle-sound">Sound: ON</div>
            <div class="menu-item" id="toggle-music">Music: ON</div>
            <div class="menu-item" id="show-high-scores">High Scores</div>
            <div class="menu-item" id="toggle-fullscreen">Fullscreen</div>
            <div class="menu-item" id="restart-from-menu">Restart</div>
        </div>

        <div id="theme-selector"> <div class="theme-btn active" id="standard-theme" title="Standard Theme"></div> /* [cite: 245] */
            <div class="theme-btn" id="neon-theme" title="Neon Theme"></div>
            <div class="theme-btn" id="retro-theme" title="Retro Theme"></div>
        </div>
        <div id="start-screen">
            <h1>BRICK BREAKER</h1>
            <div id="instructions"> <p>Use your mouse or arrow keys to move the paddle and bounce the ball /* [cite: 246] */
to break all bricks.</p>
                <p>Don't let the ball fall off the bottom of the screen!</p>
                <p>Some bricks need multiple hits to break!</p> <p>Watch for special power-ups!</p> <p>Press 'P' to pause the game at any time.</p>
            </div> <button id="start-button">START GAME</button>
            <button id="high-scores-button">HIGH SCORES</button>

        </div> /* [cite: 247] */
        <div id="high-scores">
            <h2>HIGH SCORES</h2> <div id="scores-list">
                </div>
            <button id="back-button">BACK</button>
        </div>
        <div id="game-over">
            <h2>GAME OVER</h2> <div id="final-score"></div>
            <div id="game-stats"></div>

            <div id="new-high-score" style="color: gold; font-size: 24px; margin: 10px 0; /* [cite: 248] */
display: none;"> /* [cite: 249] */
                NEW HIGH SCORE!
            </div> <input type="text" id="name-input" placeholder="Enter your name" style="display: none;">
            <button id="save-score-button" style="display: none;">SAVE SCORE</button>
            <button id="restart-button">PLAY AGAIN</button>
            <button id="show-scores-button">HIGH SCORES</button>
        </div>
        <div
id="level-complete"> /* [cite: 250] */
            <h2>LEVEL COMPLETE!</h2> <div id="level-score"></div>
            <div id="level-stats"></div>
            <button id="next-level-button">NEXT LEVEL</button>
        </div>
        <div id="pause-indicator">PAUSED</div>
        <div id="mobile-controls">
            <div class="mobile-btn" id="left-btn">  ◀  </div>
            <div class="mobile-btn"
id="right-btn">  ▶  </div> </div> /* [cite: 251] */
    </div>
    <script>
        // Debug mode - set to false for production
        const DEBUG_MODE = false; /* [cite: 413] */
        // Game constants
        const PADDLE_HEIGHT = 20; /* [cite: 252] */
        let PADDLE_WIDTH = 100; /* [cite: 253] */
        const BALL_RADIUS = 10; /* [cite: 254] */
        const BRICK_ROWS = 5; /* [cite: 255] */
        const BRICK_COLUMNS = 10; /* [cite: 256] */
        const BRICK_HEIGHT = 30; /* [cite: 257] */
        const BRICK_WIDTH = 75; /* [cite: 258] */
        const BRICK_PADDING = 5; /* [cite: 259] */
        const BRICK_OFFSET_TOP = 80; /* [cite: 260] */
        const BRICK_OFFSET_LEFT = 15; /* [cite: 261] */
        // Game variables
        let canvas, ctx, scoreDisplay, livesDisplay, levelDisplay, comboDisplay,
            fpsDisplay, gameOverScreen, levelCompleteScreen, startScreen,
            pauseIndicator, finalScoreDisplay, gameStatsDisplay, levelScoreDisplay,
            levelStatsDisplay, debugPanel, screenFlash; /* [cite: 262] */
        let paddleX = 0; /* [cite: 263] */
        let ballX = 0; /* [cite: 264] */
        let ballY = 0; /* [cite: 265] */
        let ballSpeedX = 4; /* [cite: 266] */
        let ballSpeedY = -4; /* [cite: 267] */
        let rightPressed = false; /* [cite: 268] */
        let leftPressed = false; /* [cite: 269] */
        let score = 0; /* [cite: 270] */
        let lives = 3; /* [cite: 271] */
        let level = 1; /* [cite: 272] */
        let combo = 0; /* [cite: 273] */
        let maxCombo = 0; /* [cite: 274] */
        let comboTimer = 0; /* [cite: 275] */
        let gameStarted = false; /* [cite: 276] */
        let gamePaused = false; /* [cite: 277] */
        let bricksHit = 0; /* [cite: 278] */
        let totalBricks = 0; /* [cite: 279] */
        let paddleHits = 0; /* [cite: 280] */
        let gameTime = 0; /* [cite: 281] */
        let startTime = 0; /* [cite: 282] */
        let lastFrameTime = 0; /* [cite: 283] */
        let frameCount = 0; /* [cite: 284] */
        let fps = 0; /* [cite: 285] */
        let lastFpsUpdate = 0; /* [cite: 286] */
        let soundEnabled = true; /* [cite: 287] */
        let musicEnabled = true; /* [cite: 288] */
        let currentTheme = 'standard'; /* [cite: 289] */
        let screenShaking = false; /* [cite: 290] */
        let backgroundMusic = null; /* [cite: 291] */
        let multiballActive = false; /* [cite: 292] */
        let balls = []; /* [cite: 293] */
        // Store the various themes
        const themes = {
            standard: {
                background: {
                    start: '#000033', /* [cite: 424] */

 end: '#000022' /* [cite: 294] */
                }, /* [cite: 425] */
                paddle: {
                    start: '#4444ff', /* [cite: 425] */
                    end: '#2222aa'

 }, /* [cite: 295] */
                ball: {
                    start: '#ffffff', /* [cite: 426] */
                    end: '#aaaaff'
                },
                brick: {

  0: '#FF5555', /* [cite: 426] */ // Red
                    1: '#FFAA55', /* [cite: 427] */ // Orange
                    2: '#FFFF55', /* [cite: 427] */ // Yellow
                    3: '#55FF55', /* [cite: 297] */ // Green
                    4: '#55FFFF'  /* [cite: 427] */ // Cyan
                }, /* [cite: 428] */
                particles: {
                    paddle: '#4444ff', /* [cite: 428] */

  wall: '#ffffff' /* [cite: 298] */
                },
                screen: {
                    bg: 'rgba(10, 10, 42, 0.9)' /* [cite: 429] */
                }

 }, /* [cite: 299] */
            neon: {
                background: {
                    start: '#000000', /* [cite: 430] */
                    end: '#110011'
                },

  paddle: { /* [cite: 300] */
                    start: '#ff00ff', /* [cite: 430] */
                    end: '#aa00aa'
                }, /* [cite: 431] */
                ball: {

  start: '#ffffff', /* [cite: 431] */
                    end: '#ff88ff'
                },
                brick: { /* [cite: 432] */

  0: '#ff0066', // Pink /* [cite: 302] */
                    1: '#ff3300', // Red-Orange
                    2: '#ffcc00', // Yellow
                    3: '#33ff00', // Green
                    4: '#00ffcc'  /* [cite: 433] */ // Cyan
                }, /* [cite: 303] */
                particles: {
                    paddle: '#ff00ff', /* [cite: 433] */
                    wall: '#00ffff'
                }, /* [cite: 434] */

  screen: { /* [cite: 304] */
                    bg: 'rgba(17, 0, 17, 0.9)'
                }
            },
            retro: {
                background: { /* [cite: 305] */
                    start: '#222211',
                    end: '#111100'
                },
                paddle: {
                    start: '#cccc44', /* [cite: 306] */
                    end: '#aaaa22'
                },
                ball: {
                    start: '#ffffff',
                    end: '#eeeebb' /* [cite: 307] */
                },
                brick: {
                    0: '#cc4400', /* [cite: 437] */ // Dark Orange
                    1: '#ccaa00', // Gold

  2: '#44cc00', /* [cite: 438] */ // Lime /* [cite: 308] */
                    3: '#00ccaa', // Teal
                    4: '#0044cc'  // Blue
                },
                particles: {

  paddle: '#cccc44', /* [cite: 439] */
                    wall: '#ffffff'
                },
                screen: {
                    bg: 'rgba(34, 34, 17, 0.9)'

  } /* [cite: 440] */ /* [cite: 310] */
            }
        }; /* [cite: 441] */ /* [cite: 311] */
        // Power-up variables
        const paddleWidthNormal = PADDLE_WIDTH; /* [cite: 441] */ /* [cite: 312] */
        const paddleWidthWide = PADDLE_WIDTH * 1.5; /* [cite: 441] */ /* [cite: 313] */
        const ballSpeedNormal = 4; /* [cite: 442] */ /* [cite: 314] */
        const ballSpeedSlow = 2; /* [cite: 442] */ /* [cite: 315] */
        let powerupActive = false; /* [cite: 442] */ /* [cite: 316] */
        let powerupTimer = 0; /* [cite: 442] */ /* [cite: 317] */
        let activePowerupType = null; /* [cite: 442] */ /* [cite: 318] */
        // Create arrays
        let bricks = []; /* [cite: 443] */ /* [cite: 319] */
        let stars = []; /* [cite: 443] */ /* [cite: 320] */
        let particles = []; /* [cite: 444] */ /* [cite: 321] */
        let powerups = []; /* [cite: 444] */ /* [cite: 322] */
        // High scores
        let highScores = []; /* [cite: 444] */ /* [cite: 323] */
        // Debug function
        function debug(message) {
            if (DEBUG_MODE && debugPanel) { /* [cite: 445] */
                debugPanel.innerHTML += message + "<br>"; /* [cite: 445] */ /* [cite: 324] */
                // Keep only the last 5 messages
                const lines = debugPanel.innerHTML.split("<br>"); /* [cite: 446] */ /* [cite: 325] */
                if (lines.length > 6) { /* [cite: 447] */
                    debugPanel.innerHTML = lines.slice(lines.length - 6).join("<br>"); /* [cite: 447] */ /* [cite: 326] */
                } /* [cite: 448] */
            } /* [cite: 448] */
            console.log(message); /* [cite: 448] */ /* [cite: 327] */
        } /* [cite: 449] */
        // Load high scores from local storage
        function loadHighScores() {
            const savedScores = localStorage.getItem('brickBreakerHighScores'); /* [cite: 449] */ /* [cite: 328] */
            if (savedScores) { /* [cite: 450] */
                try {
                    highScores = JSON.parse(savedScores); /* [cite: 450] */ /* [cite: 329] */
                    debug("Loaded high scores from local storage"); /* [cite: 451] */ /* [cite: 330] */
                } catch (e) {
                    debug("Error loading high scores: " + e.message); /* [cite: 451] */ /* [cite: 331] */
                    highScores = []; /* [cite: 452] */ /* [cite: 332] */
                }
            } else { /* [cite: 452] */
                highScores = [
   { name: "AAA", score: 5000, level: 3 }, /* [cite: 333] */
   { name: "BBB", score: 3500, level: 2 },
                    { name: "CCC", score: 2000, level: 2 }, /* [cite: 453] */
                    { name: "DDD", score: 1000, level: 1 },
                    { name: "EEE", score: 500, level: 1 }

 ]; /* [cite: 453] */ /* [cite: 334, 335] */
                saveHighScores(); /* [cite: 454] */ /* [cite: 336] */
            }
        }
        // Save high scores to local storage
        function saveHighScores() {
            try {
                localStorage.setItem('brickBreakerHighScores', JSON.stringify(highScores)); /* [cite: 454] */ /* [cite: 337] */
                debug("Saved high scores to local storage"); /* [cite: 455] */ /* [cite: 338] */
            } catch (e) {
                debug("Error saving high scores: " + e.message); /* [cite: 455] */ /* [cite: 339] */
            } /* [cite: 456] */
        }
        // Check if score is a high score
        function isHighScore(score) {
            return highScores.length < 10 || /* [cite: 456] */ /* [cite: 340] */
                   score > highScores[highScores.length - 1].score; /* [cite: 457] */ /* [cite: 341] */
        }
        // Add a new high score
        function addHighScore(name, score, level) {
            highScores.push({ name, score, level }); /* [cite: 457] */ /* [cite: 342] */
            highScores.sort((a, b) => b.score - a.score); /* [cite: 458] */ /* [cite: 343] */
            if (highScores.length > 10) { /* [cite: 458] */
                highScores = highScores.slice(0, 10); /* [cite: 458] */ /* [cite: 344] */
            } /* [cite: 459] */
            saveHighScores(); /* [cite: 459] */ /* [cite: 345] */
        } /* [cite: 460] */
        // Display high scores
        function displayHighScores() {
            const scoresList = document.getElementById('scores-list'); /* [cite: 460] */ /* [cite: 346] */
            scoresList.innerHTML = ''; /* [cite: 461] */ /* [cite: 347] */
            if (highScores.length === 0) { /* [cite: 461] */
                scoresList.innerHTML = '<div class="score-row">No high scores yet!</div>'; /* [cite: 461] */ /* [cite: 348] */
                return; /* [cite: 462] */ /* [cite: 349] */
            }
            highScores.forEach((score, index) => { /* [cite: 462] */
                const row = document.createElement('div'); /* [cite: 462] */
                row.className = 'score-row'; /* [cite: 462] */
                row.innerHTML = `

  <span>${index + 1}. ${score.name}</span> /* [cite: 463] */ /* [cite: 350] */
                    <span>${score.score} (Level ${score.level})</span>
                `; /* [cite: 463] */
                scoresList.appendChild(row); /* [cite: 463] */
            });
        } /* [cite: 464] */ /* [cite: 351] */
        // Initialize all DOM elements safely
        function initializeElements() {
            debug("Initializing DOM elements..."); /* [cite: 464] */ /* [cite: 352] */
            canvas = document.getElementById("gameCanvas"); /* [cite: 465] */ /* [cite: 353] */
            if (!canvas) { /* [cite: 465] */
                debug("Error: Canvas element not found!"); /* [cite: 465] */ /* [cite: 354] */
                return false; /* [cite: 466] */ /* [cite: 355] */
            }
            try {
                ctx = canvas.getContext("2d"); /* [cite: 466] */ /* [cite: 356] */
                if (!ctx) { /* [cite: 467] */
                    debug("Error: Could not get canvas context!"); /* [cite: 467] */ /* [cite: 357] */
                    return false; /* [cite: 468] */ /* [cite: 358] */
                }
                scoreDisplay = document.getElementById("score"); /* [cite: 468] */ /* [cite: 359] */
                livesDisplay = document.getElementById("lives"); /* [cite: 469] */ /* [cite: 360] */
                levelDisplay = document.getElementById("level-display"); /* [cite: 469] */ /* [cite: 361] */
                comboDisplay = document.getElementById("combo-display"); /* [cite: 469] */ /* [cite: 362] */
                fpsDisplay = document.getElementById("fps"); /* [cite: 469] */ /* [cite: 363] */
                gameOverScreen = document.getElementById("game-over"); /* [cite: 469] */ /* [cite: 364] */
                levelCompleteScreen = document.getElementById("level-complete"); /* [cite: 469] */ /* [cite: 365] */
                startScreen = document.getElementById("start-screen"); /* [cite: 470] */ /* [cite: 366] */
                pauseIndicator = document.getElementById("pause-indicator"); /* [cite: 470] */ /* [cite: 367] */
                finalScoreDisplay = document.getElementById("final-score"); /* [cite: 470] */ /* [cite: 368] */
                gameStatsDisplay = document.getElementById("game-stats"); /* [cite: 470] */ /* [cite: 369] */
                levelScoreDisplay = document.getElementById("level-score"); /* [cite: 470] */ /* [cite: 370] */
                levelStatsDisplay = document.getElementById("level-stats"); /* [cite: 470] */ /* [cite: 371] */
                debugPanel = document.getElementById("debug-panel"); /* [cite: 471] */ /* [cite: 372] */
                screenFlash = document.getElementById("screen-flash"); /* [cite: 471] */ /* [cite: 373] */
                if (DEBUG_MODE && debugPanel) { /* [cite: 471] */
                    debugPanel.style.display = "block"; /* [cite: 471] */ /* [cite: 374] */
                } /* [cite: 472] */
                // Set initial paddle and ball positions
                paddleX = (canvas.width - PADDLE_WIDTH) / 2; /* [cite: 472] */ /* [cite: 375] */
                ballX = canvas.width / 2; /* [cite: 473] */ /* [cite: 376] */
                ballY = canvas.height - PADDLE_HEIGHT - BALL_RADIUS - 10; /* [cite: 473] */ /* [cite: 377] */
                // Initialize the first ball in the balls array
                balls = [{ /* [cite: 474] */

 x: ballX,
                    y: ballY,

  speedX: ballSpeedX, /* [cite: 378] */
                    speedY: ballSpeedY, /* [cite: 475] */
                    radius: BALL_RADIUS,
                    fireball: false
                }]; /* [cite: 475] */ /* [cite: 379] */
                debug("DOM elements initialized successfully!"); /* [cite: 476] */ /* [cite: 380] */
                return true; /* [cite: 476] */ /* [cite: 381] */
            } catch (e) {
                debug("Error initializing elements: " + e.message); /* [cite: 476] */ /* [cite: 382] */
                return false; /* [cite: 477] */ /* [cite: 383] */
            }
        }
        // Create special bricks that require multiple hits
        function createBricks() {
            bricks = []; /* [cite: 477] */ /* [cite: 384] */
            for (let c = 0; c < BRICK_COLUMNS; c++) { /* [cite: 478] */
                bricks[c] = []; /* [cite: 478] */ /* [cite: 385] */
                for (let r = 0; r < BRICK_ROWS; r++) { /* [cite: 479] */
                    // Determine if this should be a special brick (more common in higher levels)
                    let specialChance = 0.05 + (level - 1) * 0.05; /* [cite: 479] */ /* [cite: 386] */
                    // 5% base + 5% per level
                    let isSpecial = Math.random() < specialChance; /* [cite: 480] */ /* [cite: 387] */
                    let hitPoints = isSpecial ? /* [cite: 481] */ /* [cite: 388] */
 2 + Math.floor(Math.random() * level) : 1; /* [cite: 481] */
                    hitPoints = Math.min(hitPoints, 3); /* [cite: 481] */ /* [cite: 389] */
                    // Cap at 3 hits
                    bricks[c][r] = { /* [cite: 482] */

  x: 0,

  y: 0, /* [cite: 390] */
                        status: hitPoints, /* [cite: 483] */
                        maxHits: hitPoints,
                        color: themes[currentTheme].brick[r], /* [cite: 483] */

  special: isSpecial /* [cite: 484] */ /* [cite: 391] */
                    };
 } /* [cite: 485] */ /* [cite: 392] */
            }
            // Count total bricks (each hit point counts as one for progression)
            totalBricks = 0; /* [cite: 485] */ /* [cite: 393] */
            for (let c = 0; c < BRICK_COLUMNS; c++) { /* [cite: 486] */
                for (let r = 0; r < BRICK_ROWS; r++) { /* [cite: 486] */
                    totalBricks += bricks[c][r].status; /* [cite: 486] */ /* [cite: 394] */
                } /* [cite: 487] */
            }
            bricksHit = 0; /* [cite: 487] */ /* [cite: 395] */
            debug(`Created ${BRICK_COLUMNS * BRICK_ROWS} bricks (${totalBricks} hit points total)`); /* [cite: 488] */ /* [cite: 396] */
            // Add moving bricks in higher levels (level 3+)
            if (level >= 3) { /* [cite: 488] */
                let movingRow = Math.floor(Math.random() * BRICK_ROWS); /* [cite: 488] */ /* [cite: 397] */
                for (let c = 0; c < BRICK_COLUMNS; c++) { /* [cite: 489] */
                    bricks[c][movingRow].moving = true; /* [cite: 489] */ /* [cite: 398] */
                    bricks[c][movingRow].moveDir = c % 2 === 0 ? /* [cite: 490] */ /* [cite: 399] */
 1 : -1; /* [cite: 490] */
                    bricks[c][movingRow].moveSpeed = 0.5 + (level - 3) * 0.2; /* [cite: 490] */ /* [cite: 400] */
                } /* [cite: 491] */
                debug(`Added moving bricks in row ${movingRow + 1}`); /* [cite: 491] */ /* [cite: 401] */
            } /* [cite: 492] */
        }
        function drawBall() {
            // Draw each ball in the balls array
            balls.forEach(ball => { /* [cite: 557] */
                ctx.beginPath();

  ctx.arc(ball.x, ball.y, ball.radius, 0, Math.PI * 2); /* [cite: 557] */ /* [cite: 402] */
                // Create gradient for ball
                let ballGradient = ctx.createRadialGradient( /* [cite: 557] */
                    ball.x - ball.radius / 3,


  ball.y - ball.radius / 3, /* [cite: 558] */ /* [cite: 403] */
                    0,
                    ball.x,
                    ball.y,
                    ball.radius


  ); /* [cite: 559] */ /* [cite: 404] */
                ballGradient.addColorStop(0, themes[currentTheme].ball.start); /* [cite: 559] */
                ballGradient.addColorStop(1, themes[currentTheme].ball.end); /* [cite: 559] */
                ctx.fillStyle = ballGradient; /* [cite: 559] */
                ctx.fill(); /* [cite: 559] */

  ctx.closePath(); /* [cite: 405] */
                /* [cite: 560] */
                // Ball glow effect
                ctx.beginPath(); /* [cite: 560] */ /* [cite: 407] */
                ctx.arc(ball.x, ball.y, ball.radius + 3, 0, Math.PI * 2); /* [cite: 560] */ /* [cite: 408] */
                ctx.strokeStyle = "rgba(100, 100, 255, 0.3)"; /* [cite: 561] */ /* [cite: 409] */
                ctx.lineWidth = 2; /* [cite: 561] */ /* [cite: 410] */
                ctx.stroke(); /* [cite: 561] */ /* [cite: 411] */
                ctx.closePath(); /* [cite: 561] */ /* [cite: 412] */
                // Add fireball effect
                if (ball.fireball) { /* [cite: 562] */
                    ctx.beginPath(); /* [cite: 562] */ /* [cite: 413] */
                    ctx.arc(ball.x, ball.y, ball.radius + 5, 0, Math.PI * 2); /* [cite: 563] */ /* [cite: 414] */
                    // Create flame gradient
                    let flameGradient = ctx.createRadialGradient( /* [cite: 563] */
                        ball.x,


  ball.y, /* [cite: 415] */
                        ball.radius, /* [cite: 564] */
                        ball.x,
                        ball.y,


  ball.radius + 5 /* [cite: 416] */
                    ); /* [cite: 565] */ /* [cite: 417] */
                    flameGradient.addColorStop(0, "rgba(255, 100, 0, 0.8)"); /* [cite: 565] */ /* [cite: 418] */
                    flameGradient.addColorStop(1, "rgba(255, 50, 0, 0)"); /* [cite: 565] */ /* [cite: 419] */
                    ctx.fillStyle = flameGradient; /* [cite: 565] */ /* [cite: 420] */
                    ctx.fill(); /* [cite: 566] */ /* [cite: 421] */
                    ctx.closePath(); /* [cite: 566] */ /* [cite: 422] */
                }
            });
        } /* [cite: 567] */ /* [cite: 423] */
        function drawPaddle() {
            ctx.beginPath(); /* [cite: 567] */ /* [cite: 424] */
            // Create gradient for paddle
            let paddleGradient = ctx.createLinearGradient( /* [cite: 568] */
                paddleX,
                canvas.height - PADDLE_HEIGHT,
                paddleX,

  canvas.height /* [cite: 425] */
            ); /* [cite: 569] */ /* [cite: 426] */
            paddleGradient.addColorStop(0, themes[currentTheme].paddle.start); /* [cite: 569] */ /* [cite: 427] */
            paddleGradient.addColorStop(1, themes[currentTheme].paddle.end); /* [cite: 569] */ /* [cite: 428] */
            // Draw main paddle with rounded corners
            // Use fallback if roundRect is not supported
            if (ctx.roundRect) { /* [cite: 569] */
                ctx.roundRect( /* [cite: 569] */
                    paddleX,

  canvas.height - PADDLE_HEIGHT, /* [cite: 570] */ /* [cite: 429] */
                    PADDLE_WIDTH,
                    PADDLE_HEIGHT,
                    [5, 5, 0, 0]


  ); /* [cite: 570] */ /* [cite: 430] */
            } else { /* [cite: 571] */
                // Fallback for browsers that don't support roundRect
                ctx.rect( /* [cite: 571] */
                    paddleX,

  canvas.height - PADDLE_HEIGHT, /* [cite: 431] */
                    PADDLE_WIDTH, /* [cite: 572] */
                    PADDLE_HEIGHT
                ); /* [cite: 572] */ /* [cite: 432] */
            } /* [cite: 573] */
            ctx.fillStyle = paddleGradient; /* [cite: 573] */ /* [cite: 433] */
            ctx.fill(); /* [cite: 574] */ /* [cite: 434] */
            // Draw paddle highlight with rounded corners
            ctx.beginPath(); /* [cite: 574] */ /* [cite: 435] */
            if (ctx.roundRect) { /* [cite: 575] */
                ctx.roundRect( /* [cite: 575] */
                    paddleX + 5,
                    canvas.height - PADDLE_HEIGHT + 3,


  PADDLE_WIDTH - 10, /* [cite: 436] */
                    PADDLE_HEIGHT / 3, /* [cite: 576] */
                    [3, 3, 0, 0]
                ); /* [cite: 576] */ /* [cite: 437] */
            } else { /* [cite: 577] */
                ctx.rect( /* [cite: 577] */
                    paddleX + 5,
                    canvas.height - PADDLE_HEIGHT + 3,


  PADDLE_WIDTH - 10, /* [cite: 438] */
                    PADDLE_HEIGHT / 3 /* [cite: 578] */
                ); /* [cite: 578] */ /* [cite: 439] */
            } /* [cite: 579] */
            ctx.fillStyle = "rgba(255, 255, 255, 0.3)"; /* [cite: 579] */ /* [cite: 440] */
            ctx.fill(); /* [cite: 580] */ /* [cite: 441] */
            // Paddle glow effect
            ctx.beginPath(); /* [cite: 580] */ /* [cite: 442] */
            if (ctx.roundRect) { /* [cite: 581] */
                ctx.roundRect( /* [cite: 581] */
                    paddleX - 2,
                    canvas.height - PADDLE_HEIGHT - 2,


  PADDLE_WIDTH + 4, /* [cite: 443] */
                    PADDLE_HEIGHT + 2, /* [cite: 582] */
                    [7, 7, 0, 0]
                ); /* [cite: 582] */ /* [cite: 444] */
            } else { /* [cite: 583] */
                ctx.rect( /* [cite: 583] */
                    paddleX - 2,
                    canvas.height - PADDLE_HEIGHT - 2,


  PADDLE_WIDTH + 4, /* [cite: 445] */
                    PADDLE_HEIGHT + 2 /* [cite: 584] */
                ); /* [cite: 584] */ /* [cite: 446] */
            } /* [cite: 585] */
            ctx.strokeStyle = "rgba(100, 100, 255, 0.5)"; /* [cite: 585] */ /* [cite: 447] */
            ctx.lineWidth = 2; /* [cite: 586] */ /* [cite: 448] */
            ctx.stroke(); /* [cite: 586] */ /* [cite: 449] */
        }
        function drawBricks() {
            for (let c = 0; c < BRICK_COLUMNS; c++) { /* [cite: 586] */
                for (let r = 0; r < BRICK_ROWS; r++) { /* [cite: 586] */
                    if (bricks[c][r].status > 0) { /* [cite: 586] */ /* [cite: 450] */
                        let brickX = c * (BRICK_WIDTH + BRICK_PADDING) + BRICK_OFFSET_LEFT; /* [cite: 587] */ /* [cite: 451] */
                        let brickY = r * (BRICK_HEIGHT + BRICK_PADDING) + BRICK_OFFSET_TOP; /* [cite: 588] */ /* [cite: 452] */
                        // Update position for moving bricks
                        if (bricks[c][r].moving) { /* [cite: 589] */
                            brickX += Math.sin(gameTime / 1000 * Math.PI) * 20 * /* [cite: 589] */ /* [cite: 453] */
 bricks[c][r].moveDir; /* [cite: 589] */
                        } /* [cite: 590] */
                        bricks[c][r].x = brickX; /* [cite: 590] */ /* [cite: 454] */
                        bricks[c][r].y = brickY; /* [cite: 591] */ /* [cite: 455] */
                        // Create gradient for brick
                        let brickGradient = ctx.createLinearGradient( /* [cite: 591] */
                            brickX,

  brickY, /* [cite: 456] */
                            brickX, /* [cite: 592] */
                            brickY + BRICK_HEIGHT

  ); /* [cite: 592] */ /* [cite: 457] */
                        let baseColor = bricks[c][r].color; /* [cite: 593] */ /* [cite: 458] */
                        // Adjust color based on hit points remaining
                        const hitRatio = bricks[c][r].status / bricks[c][r].maxHits; /* [cite: 593] */ /* [cite: 459] */
                        baseColor = adjustColorBrightness(baseColor, hitRatio * 100); /* [cite: 594] */ /* [cite: 460] */
                        let lighterColor = lightenColor(baseColor, 30); /* [cite: 594] */ /* [cite: 461] */
                        let darkerColor = darkenColor(baseColor, 30); /* [cite: 594] */ /* [cite: 462] */
                        brickGradient.addColorStop(0, lighterColor); /* [cite: 594] */ /* [cite: 463] */
                        brickGradient.addColorStop(1, darkerColor); /* [cite: 594] */ /* [cite: 464] */
                        // Draw main brick with rounded corners if supported
                        ctx.beginPath(); /* [cite: 595] */ /* [cite: 465] */
                        if (ctx.roundRect) { /* [cite: 596] */
                            ctx.roundRect( /* [cite: 596] */
                                brickX,

  brickY, /* [cite: 466] */
                                BRICK_WIDTH, /* [cite: 597] */
                                BRICK_HEIGHT,

  5 /* [cite: 467] */
                            ); /* [cite: 598] */ /* [cite: 468] */
                        } else { /* [cite: 599] */
                            ctx.rect( /* [cite: 599] */
                                brickX,

  brickY, /* [cite: 469] */
                                BRICK_WIDTH, /* [cite: 600] */
                                BRICK_HEIGHT

  ); /* [cite: 600] */ /* [cite: 470, 471] */
                        } /* [cite: 601] */
                        ctx.fillStyle = brickGradient; /* [cite: 601] */ /* [cite: 472] */
                        ctx.fill(); /* [cite: 602] */ /* [cite: 473] */
                        // Draw brick highlight
                        ctx.beginPath(); /* [cite: 602] */ /* [cite: 474] */
                        if (ctx.roundRect) { /* [cite: 603] */
                            ctx.roundRect( /* [cite: 603] */
                                brickX + 3,


  brickY + 3, /* [cite: 475] */
                                BRICK_WIDTH - 6, /* [cite: 604] */


  BRICK_HEIGHT / 3, /* [cite: 476] */
                                [3, 3, 0, 0] /* [cite: 605] */
                            ); /* [cite: 605] */ /* [cite: 477] */
                        } else { /* [cite: 606] */
                            ctx.rect( /* [cite: 606] */
                                brickX + 3,


  brickY + 3, /* [cite: 478] */
                                BRICK_WIDTH - 6, /* [cite: 607] */


  BRICK_HEIGHT / 3 /* [cite: 479] */
                            ); /* [cite: 607] */ /* [cite: 480] */
                        } /* [cite: 608] */
                        ctx.fillStyle = "rgba(255, 255, 255, 0.3)"; /* [cite: 608] */ /* [cite: 481] */
                        ctx.fill(); /* [cite: 609] */ /* [cite: 482] */
                        // Brick glow effect
                        ctx.beginPath(); /* [cite: 609] */ /* [cite: 483] */
                        if (ctx.roundRect) { /* [cite: 610] */
                            ctx.roundRect( /* [cite: 610] */
                                brickX - 1,


  brickY - 1, /* [cite: 484] */
                                BRICK_WIDTH + 2, /* [cite: 611] */


  BRICK_HEIGHT + 2, /* [cite: 485] */
                                6 /* [cite: 612] */
                            ); /* [cite: 612] */ /* [cite: 486] */
                        } else { /* [cite: 613] */
                            ctx.rect( /* [cite: 613] */
                                brickX - 1,


  brickY - 1, /* [cite: 487] */
                                BRICK_WIDTH + 2, /* [cite: 614] */


  BRICK_HEIGHT + 2 /* [cite: 488] */
                            ); /* [cite: 614] */ /* [cite: 489] */
                        } /* [cite: 615] */
                        ctx.strokeStyle = "rgba(255, 255, 255, 0.2)"; /* [cite: 615] */ /* [cite: 490] */
                        ctx.lineWidth = 1; /* [cite: 616] */ /* [cite: 491] */
                        ctx.stroke(); /* [cite: 616] */ /* [cite: 492] */
                        // Draw hit points indicator for multi-hit bricks
                        if (bricks[c][r].maxHits > 1) { /* [cite: 616] */
                            ctx.font = "bold 16px Arial"; /* [cite: 616] */ /* [cite: 493] */
                            ctx.textAlign = "center"; /* [cite: 617] */ /* [cite: 494] */
                            ctx.textBaseline = "middle"; /* [cite: 617] */ /* [cite: 495] */
                            ctx.fillStyle = "rgba(255, 255, 255, 0.8)"; /* [cite: 617] */ /* [cite: 496] */
                            ctx.fillText(bricks[c][r].status, brickX + BRICK_WIDTH/2, brickY + BRICK_HEIGHT/2); /* [cite: 617] */ /* [cite: 497] */
                        } /* [cite: 618] */
                    }
                }
            }
        }
        // Adjust color brightness based on remaining hit points /* [cite: 498] */
        function adjustColorBrightness(hexColor, percent) {
            // For multi-hit bricks, make them darker as they get hit
            let r = parseInt(hexColor.substring(1, 3), 16); /* [cite: 619] */ /* [cite: 499] */
            let g = parseInt(hexColor.substring(3, 5), 16); /* [cite: 620] */ /* [cite: 500] */
            let b = parseInt(hexColor.substring(5, 7), 16); /* [cite: 620] */ /* [cite: 501] */
            r = Math.round(r * (percent / 100)); /* [cite: 620] */ /* [cite: 502] */
            g = Math.round(g * (percent / 100)); /* [cite: 621] */ /* [cite: 503] */
            b = Math.round(b * (percent / 100)); /* [cite: 621] */ /* [cite: 504] */
            return `#${Math.min(255, r).toString(16).padStart(2, '0')}${Math.min(255, g).toString(16).padStart(2, '0')}${Math.min(255, b).toString(16).padStart(2, '0')}`; /* [cite: 622] */ /* [cite: 505] */
        }
        function lightenColor(color, percent) {
            let r = parseInt(color.substring(1, 3), 16); /* [cite: 622] */ /* [cite: 506] */
            let g = parseInt(color.substring(3, 5), 16); /* [cite: 623] */ /* [cite: 507] */
            let b = parseInt(color.substring(5, 7), 16); /* [cite: 623] */ /* [cite: 508] */
            r = Math.min(255, r + (255 - r) * (percent / 100)); /* [cite: 624] */ /* [cite: 509] */
            g = Math.min(255, g + (255 - g) * (percent / 100)); /* [cite: 625] */ /* [cite: 510] */
            b = Math.min(255, b + (255 - b) * (percent / 100)); /* [cite: 626] */ /* [cite: 511] */
            return `#${Math.round(r).toString(16).padStart(2, '0')}${Math.round(g).toString(16).padStart(2, '0')}${Math.round(b).toString(16).padStart(2, '0')}`; /* [cite: 626] */ /* [cite: 512] */
        } /* [cite: 627] */
        function darkenColor(color, percent) {
            let r = parseInt(color.substring(1, 3), 16); /* [cite: 627] */ /* [cite: 513] */
            let g = parseInt(color.substring(3, 5), 16); /* [cite: 628] */ /* [cite: 514] */
            let b = parseInt(color.substring(5, 7), 16); /* [cite: 628] */ /* [cite: 515] */
            r = Math.max(0, r - (r * (percent / 100))); /* [cite: 629] */ /* [cite: 516] */
            g = Math.max(0, g - (g * (percent / 100))); /* [cite: 629] */ /* [cite: 517] */
            b = Math.max(0, b - (b * (percent / 100))); /* [cite: 630] */ /* [cite: 518] */
            return `#${Math.round(r).toString(16).padStart(2, '0')}${Math.round(g).toString(16).padStart(2, '0')}${Math.round(b).toString(16).padStart(2, '0')}`; /* [cite: 630] */ /* [cite: 519] */
        }
        function keyDownHandler(e) {
            if (e.key === "Right" || e.key === "ArrowRight") { /* [cite: 492] */
                rightPressed = true; /* [cite: 492] */ /* [cite: 520] */
                e.preventDefault(); /* [cite: 493] */ /* [cite: 521] */
            } else if (e.key === "Left" || e.key === "ArrowLeft") { /* [cite: 493] */
                leftPressed = true; /* [cite: 493] */ /* [cite: 522] */
                e.preventDefault(); /* [cite: 494] */ /* [cite: 523] */
            } else if (e.key === "p" || e.key === "P") { /* [cite: 494] */
                togglePause(); /* [cite: 494] */ /* [cite: 524] */
                e.preventDefault(); /* [cite: 495] */ /* [cite: 525] */
            } else if (e.key === "d" || e.key === "D") { /* [cite: 495] */
                // Toggle debug mode with 'D' key
                if (DEBUG_MODE && debugPanel) { /* [cite: 495] */
                    debugPanel.style.display = debugPanel.style.display === "none" /* [cite: 495] */ /* [cite: 526] */
? /* [cite: 495] */
                                              "block" : "none"; /* [cite: 496] */ /* [cite: 527] */
                }
            } else if (e.key === "m" || e.key === "M") { /* [cite: 496] */
                toggleMusic(); /* [cite: 496] */ /* [cite: 528] */
            } else if (e.key === "s" || e.key === "S") { /* [cite: 497] */
                toggleSound(); /* [cite: 497] */ /* [cite: 529] */
            } else if (e.key === "f" || e.key === "F") { /* [cite: 498] */
                toggleFullscreen(); /* [cite: 498] */ /* [cite: 530] */
            } /* [cite: 499] */
        }
        function keyUpHandler(e) {
            if (e.key === "Right" || e.key === "ArrowRight") { /* [cite: 499] */
                rightPressed = false; /* [cite: 499] */ /* [cite: 531] */
            } else if (e.key === "Left" || e.key === "ArrowLeft") { /* [cite: 500] */
                leftPressed = false; /* [cite: 500] */ /* [cite: 532] */
            } /* [cite: 501] */
        }
        function mouseMoveHandler(e) {
            if (!gameStarted || gamePaused) return; /* [cite: 501] */ /* [cite: 533] */
            let relativeX; /* [cite: 502] */ /* [cite: 534] */
            // Get the correct mouse position based on the canvas position
            const rect = canvas.getBoundingClientRect(); /* [cite: 502] */ /* [cite: 535] */
            relativeX = e.clientX - rect.left; /* [cite: 503] */ /* [cite: 536] */
            // Scale the mouse position if the canvas is resized
            if (canvas.width !== rect.width) { /* [cite: 503] */
                relativeX = relativeX * (canvas.width / rect.width); /* [cite: 503] */ /* [cite: 537] */
            } /* [cite: 504] */
            if (relativeX > 0 && relativeX < canvas.width) { /* [cite: 504] */
                paddleX = relativeX - PADDLE_WIDTH / 2; /* [cite: 504] */ /* [cite: 538] */
                // Keep paddle within canvas
                if (paddleX < 0) { /* [cite: 505] */
                    paddleX = 0; /* [cite: 505] */ /* [cite: 539] */
                } else if (paddleX + PADDLE_WIDTH > canvas.width) { /* [cite: 506] */
                    paddleX = canvas.width - PADDLE_WIDTH; /* [cite: 506] */ /* [cite: 540] */
                } /* [cite: 507] */
            }
        }
        // Add touch event handlers for mobile
        function setupMobileControls() {
            const leftBtn = document.getElementById('left-btn'); /* [cite: 507] */ /* [cite: 541] */
            const rightBtn = document.getElementById('right-btn'); /* [cite: 508] */ /* [cite: 542] */
            // Helper function to detect if we're on a mobile device
            function isMobileDevice() {
                return (typeof window.orientation !== "undefined") || /* [cite: 508] */ /* [cite: 543] */
                       (navigator.userAgent.indexOf('IEMobile') !== -1); /* [cite: 509] */ /* [cite: 544] */
            }
            // Show mobile controls if on a mobile device
            if (isMobileDevice()) { /* [cite: 509] */
                const mobileControls = document.getElementById('mobile-controls'); /* [cite: 509] */ /* [cite: 545] */
                if (mobileControls) { /* [cite: 510] */
                    mobileControls.style.display = 'flex'; /* [cite: 510] */ /* [cite: 546] */
                } /* [cite: 511] */
                // Add touch events for mobile buttons
                if (leftBtn) { /* [cite: 511] */
                    // Handle continuous movement on touch

  leftBtn.addEventListener('touchstart', function(e) { /* [cite: 512] */ /* [cite: 547] */
                        leftPressed = true; /* [cite: 512] */
                        e.preventDefault(); /* [cite: 512] */
                    }); /* [cite: 512] */ /* [cite: 548] */
                    leftBtn.addEventListener('touchend', function() { /* [cite: 513] */
                        leftPressed = false; /* [cite: 513] */
                    }); /* [cite: 513] */ /* [cite: 549] */
                } /* [cite: 514] */
                if (rightBtn) { /* [cite: 514] */
                    rightBtn.addEventListener('touchstart', function(e) { /* [cite: 514] */
                        rightPressed = true; /* [cite: 514] */ /* [cite: 550] */
                        e.preventDefault(); /* [cite: 515] */
                    }); /* [cite: 515] */ /* [cite: 551] */
                    rightBtn.addEventListener('touchend', function() { /* [cite: 516] */
                        rightPressed = false; /* [cite: 516] */
                    }); /* [cite: 516] */ /* [cite: 552] */
                } /* [cite: 517] */
            }
        }
        function togglePause() {
            if (!gameStarted) return; /* [cite: 517] */ /* [cite: 553] */
            gamePaused = !gamePaused; /* [cite: 518] */ /* [cite: 554] */
            pauseIndicator.style.display = gamePaused ? /* [cite: 518] */ /* [cite: 555] */
 "block" : "none"; /* [cite: 518] */
            if (!gamePaused) { /* [cite: 519] */
                lastFrameTime = performance.now(); /* [cite: 519] */ /* [cite: 556] */
                requestAnimationFrame(draw); /* [cite: 520] */ /* [cite: 557] */
                resumeMusic(); /* [cite: 520] */ /* [cite: 558] */
                debug("Game unpaused"); /* [cite: 520] */ /* [cite: 559] */
            } else {
                pauseMusic(); /* [cite: 520] */ /* [cite: 560] */
                debug("Game paused"); /* [cite: 521] */ /* [cite: 561] */
            }
        }
        function toggleSound() {
            soundEnabled = !soundEnabled; /* [cite: 521] */ /* [cite: 562] */
            const soundToggle = document.getElementById('toggle-sound'); /* [cite: 522] */ /* [cite: 563] */
            if (soundToggle) { /* [cite: 522] */
                soundToggle.textContent = `Sound: ${soundEnabled ? /* [cite: 522] */ /* [cite: 564] */
                                           'ON' : 'OFF'}`; /* [cite: 523] */ /* [cite: 565] */
            }
            debug(`Sound ${soundEnabled ? 'enabled' : 'disabled'}`); /* [cite: 523] */ /* [cite: 566] */
        } /* [cite: 524] */
        function toggleMusic() {
            musicEnabled = !musicEnabled; /* [cite: 524] */ /* [cite: 567] */
            const musicToggle = document.getElementById('toggle-music'); /* [cite: 525] */ /* [cite: 568] */
            if (musicToggle) { /* [cite: 525] */
                musicToggle.textContent = `Music: ${musicEnabled ? /* [cite: 525] */ /* [cite: 569] */
                                           'ON' : 'OFF'}`; /* [cite: 526] */ /* [cite: 570] */
            }
            if (musicEnabled) { /* [cite: 526] */
                playMusic(); /* [cite: 526] */ /* [cite: 571] */
            } else { /* [cite: 527] */
                stopMusic(); /* [cite: 527] */ /* [cite: 572] */
            } /* [cite: 528] */
            debug(`Music ${musicEnabled ? 'enabled' : 'disabled'}`); /* [cite: 528] */ /* [cite: 573] */
        } /* [cite: 529] */
        function toggleFullscreen() {
            if (!document.fullscreenElement) { /* [cite: 529] */
                document.documentElement.requestFullscreen().catch(err => { /* [cite: 529] */
                    debug("Error attempting to enable fullscreen: " + err.message); /* [cite: 529] */

  }); /* [cite: 574] */
 } else { /* [cite: 530] */ /* [cite: 575] */
                if (document.exitFullscreen) { /* [cite: 530] */
                    document.exitFullscreen(); /* [cite: 530] */ /* [cite: 576] */
                } /* [cite: 531] */
            }
        }
        // Play background music
        function playMusic() {
            if (!musicEnabled) return; /* [cite: 531] */ /* [cite: 577] */
            try { /* [cite: 532] */
                if (!backgroundMusic) { /* [cite: 532] */
                    const AudioContext = window.AudioContext || /* [cite: 532] */ /* [cite: 578] */
                                       window.webkitAudioContext; /* [cite: 533] */ /* [cite: 579] */
                    const audioCtx = new AudioContext(); /* [cite: 533] */ /* [cite: 580] */
                    backgroundMusic = { /* [cite: 533] */
                        context: audioCtx,
                        oscillator: null,


  gain: null, /* [cite: 581] */
                        playing: false /* [cite: 534] */
                    }; /* [cite: 534] */ /* [cite: 582] */
                    // Create a simple ambient background using multiple oscillators
                    function createAmbience() { /* [cite: 535] */
                        const oscillator1 = audioCtx.createOscillator(); /* [cite: 535] */ /* [cite: 583] */
                        const oscillator2 = audioCtx.createOscillator(); /* [cite: 536] */ /* [cite: 584] */
                        const gainNode = audioCtx.createGain(); /* [cite: 536] */ /* [cite: 585] */
                        oscillator1.type = "sine"; /* [cite: 536] */ /* [cite: 586] */
                        oscillator1.frequency.value = 60 + level * 5; /* [cite: 536] */ /* [cite: 587] */
                        // Base frequency changes with level
                        oscillator2.type = "sine"; /* [cite: 537] */ /* [cite: 588] */
                        oscillator2.frequency.value = 90 + level * 7; /* [cite: 538] */ /* [cite: 589] */
                        gainNode.gain.value = 0.05; /* [cite: 538] */ /* [cite: 590] */
                        // Very quiet background
                        oscillator1.connect(gainNode); /* [cite: 539] */ /* [cite: 591] */
                        oscillator2.connect(gainNode); /* [cite: 540] */ /* [cite: 592] */
                        gainNode.connect(audioCtx.destination); /* [cite: 540] */ /* [cite: 593] */
                        oscillator1.start(); /* [cite: 540] */ /* [cite: 594] */
                        oscillator2.start(); /* [cite: 540] */ /* [cite: 595] */
                        backgroundMusic.oscillator = [oscillator1, oscillator2]; /* [cite: 540] */ /* [cite: 596] */
                        backgroundMusic.gain = gainNode; /* [cite: 540] */ /* [cite: 597] */
                        backgroundMusic.playing = true; /* [cite: 540] */ /* [cite: 598] */
                    } /* [cite: 541] */
                    createAmbience(); /* [cite: 541] */ /* [cite: 599] */
                } else if (!backgroundMusic.playing) { /* [cite: 542] */
                    // If we already have a background music object but it's not playing
                    const oscillator1 = backgroundMusic.context.createOscillator(); /* [cite: 542] */ /* [cite: 600] */
                    const oscillator2 = backgroundMusic.context.createOscillator(); /* [cite: 543] */ /* [cite: 601] */
                    const gainNode = backgroundMusic.context.createGain(); /* [cite: 543] */ /* [cite: 602] */
                    oscillator1.type = "sine"; /* [cite: 543] */ /* [cite: 603] */
                    oscillator1.frequency.value = 60 + level * 5; /* [cite: 543] */ /* [cite: 604] */
                    oscillator2.type = "sine"; /* [cite: 544] */ /* [cite: 605] */
                    oscillator2.frequency.value = 90 + level * 7; /* [cite: 544] */ /* [cite: 606] */
                    gainNode.gain.value = 0.05; /* [cite: 544] */ /* [cite: 607] */
                    oscillator1.connect(gainNode); /* [cite: 544] */ /* [cite: 608] */
                    oscillator2.connect(gainNode); /* [cite: 544] */ /* [cite: 609] */
                    gainNode.connect(backgroundMusic.context.destination); /* [cite: 544] */ /* [cite: 610] */
                    oscillator1.start(); /* [cite: 544] */ /* [cite: 611] */
                    oscillator2.start(); /* [cite: 544] */ /* [cite: 612] */
                    backgroundMusic.oscillator = [oscillator1, oscillator2]; /* [cite: 545] */ /* [cite: 613] */
                    backgroundMusic.gain = gainNode; /* [cite: 545] */ /* [cite: 614] */
                    backgroundMusic.playing = true; /* [cite: 545] */ /* [cite: 615] */
                } /* [cite: 546] */
            } catch (e) {
                debug("Error playing music: " + e.message); /* [cite: 546] */ /* [cite: 616] */
            } /* [cite: 547] */
        }
        function stopMusic() {
            if (backgroundMusic && backgroundMusic.playing) { /* [cite: 547] */
                try {
                    if (backgroundMusic.oscillator) { /* [cite: 547] */ /* [cite: 617] */
                        if (Array.isArray(backgroundMusic.oscillator)) { /* [cite: 548] */
                            backgroundMusic.oscillator.forEach(osc => { /* [cite: 548] */
                                osc.stop(); /* [cite: 548] */ /* [cite: 618] */
                            });
 } else { /* [cite: 549] */ /* [cite: 619] */
                            backgroundMusic.oscillator.stop(); /* [cite: 549] */ /* [cite: 620] */
                        } /* [cite: 550] */
                    }
                    backgroundMusic.playing = false; /* [cite: 550] */ /* [cite: 621] */
                } catch (e) { /* [cite: 551] */
                    debug("Error stopping music: " + e.message); /* [cite: 551] */ /* [cite: 622] */
                } /* [cite: 552] */
            }
        }
        function pauseMusic() {
            if (backgroundMusic && backgroundMusic.gain) { /* [cite: 552] */
                try {

  backgroundMusic.gain.gain.value = 0; /* [cite: 623] */
                    /* [cite: 552] */ /* [cite: 624] */
                } catch (e) { /* [cite: 553] */
                    debug("Error pausing music: " + e.message); /* [cite: 553] */ /* [cite: 625] */
                } /* [cite: 554] */
            }
        }
        function resumeMusic() {
            if (musicEnabled && backgroundMusic && backgroundMusic.gain) { /* [cite: 554] */
                try {

  backgroundMusic.gain.gain.value = 0.05; /* [cite: 626] */
                    /* [cite: 554] */ /* [cite: 627] */
                } catch (e) { /* [cite: 555] */
                    debug("Error resuming music: " + e.message); /* [cite: 555] */ /* [cite: 628] */
                } /* [cite: 556] */
            }
        }
        function collisionDetection() {
            // Check each ball for collisions
            for (let i = 0; i < balls.length; i++) { /* [cite: 107] */

  let ball = balls[i]; /* [cite: 107] */ /* [cite: 629, 630] */
                for (let c = 0; c < BRICK_COLUMNS; c++) { /* [cite: 108] */
                    for (let r = 0; r < BRICK_ROWS; r++) { /* [cite: 108] */
                        let b = bricks[c][r]; /* [cite: 108] */ /* [cite: 631] */
                        if (b.status > 0) { /* [cite: 109] */
                            if (
                                ball.x > b.x - /* [cite: 109] */ /* [cite: 632] */
 ball.radius && /* [cite: 109] */
                                ball.x < b.x + BRICK_WIDTH + ball.radius && /* [cite: 110] */
                                ball.y > b.y - ball.radius &&

  ball.y < b.y + BRICK_HEIGHT + ball.radius /* [cite: 110] */ /* [cite: 633] */
                            ) { /* [cite: 111] */
                                // Calculate exact collision point

  let hitLeft = ball.x < b.x; /* [cite: 634, 635] */
                                let hitRight = ball.x > b.x + BRICK_WIDTH; /* [cite: 112] */ /* [cite: 636] */
                                let hitTop = ball.y < b.y; /* [cite: 112] */ /* [cite: 637] */
                                let hitBottom = ball.y > b.y + BRICK_HEIGHT; /* [cite: 113] */ /* [cite: 638] */
                                // Determine bounce direction
                                if ((hitLeft || hitRight) && !hitTop && !hitBottom) { /* [cite: 113] */

  ball.speedX = -ball.speedX; /* [cite: 113] */ /* [cite: 639, 640] */
                                } else { /* [cite: 114] */
                                    ball.speedY = -ball.speedY; /* [cite: 114] */ /* [cite: 641] */
                                } /* [cite: 115] */
                                // Fireball effect - destroy adjacent bricks

  if (ball.fireball) { /* [cite: 116] */ /* [cite: 642] */
                                    applyFireballEffect(ball.x, ball.y); /* [cite: 116] */ /* [cite: 643] */
                                } /* [cite: 117] */
                                // Decrease brick hit points

  b.status--; /* [cite: 118] */ /* [cite: 644] */
                                bricksHit++; /* [cite: 118] */ /* [cite: 645] */
                                // Update score based on brick type
                                let pointValue = 10 * level; /* [cite: 118] */ /* [cite: 646] */
                                if (b.special) { /* [cite: 119] */
                                    pointValue *= 2; /* [cite: 119] */ /* [cite: 647] */
                                    // Double points for special bricks
                                } /* [cite: 120] */

  // Add combo bonus /* [cite: 648] */
                                if (comboTimer > 0) { /* [cite: 121] */
                                    combo++; /* [cite: 121] */ /* [cite: 649] */
                                    if (combo > maxCombo) { /* [cite: 122] */
                                        maxCombo = combo; /* [cite: 122] */ /* [cite: 650] */
                                    } /* [cite: 123] */
                                    pointValue *= (1 + combo * 0.1); /* [cite: 123] */ /* [cite: 651] */
                                    // 10% bonus per combo level
                                    // Show combo display

  comboDisplay.textContent = `Combo x${combo}`; /* [cite: 125] */ /* [cite: 652, 653] */
                                    comboDisplay.style.opacity = "1"; /* [cite: 126] */ /* [cite: 654] */
                                } else {
                                    combo = 1; /* [cite: 126] */ /* [cite: 655] */
                                    comboDisplay.textContent = `Combo x${combo}`; /* [cite: 127] */ /* [cite: 656] */
                                    comboDisplay.style.opacity = "1"; /* [cite: 127] */ /* [cite: 657] */
                                }
                                // Reset combo timer

  comboTimer = 120; /* [cite: 128] */ // 2 seconds at 60fps /* [cite: 658] */
                                score += Math.round(pointValue); /* [cite: 128] */ /* [cite: 659] */
                                if (scoreDisplay) { /* [cite: 129] */
                                    scoreDisplay.textContent = `Score: ${score}`; /* [cite: 129] */ /* [cite: 660] */
                                } /* [cite: 130] */
                                // Create particles with brick color

  createParticles(ball.x, ball.y, b.color); /* [cite: 661, 662] */
                                // Chance to create power-up when brick is fully destroyed
                                if (b.status === 0) { /* [cite: 131] */

  createPowerup(b.x, b.y); /* [cite: 131] */ /* [cite: 663, 664] */
                                } /* [cite: 132] */
                                // Add screen flash and shake for special bricks

  if (b.special && b.status === 0) { /* [cite: 133] */ /* [cite: 665] */
                                    flashScreen(); /* [cite: 133] */ /* [cite: 666] */
                                    shakeScreen(); /* [cite: 134] */ /* [cite: 667] */
                                }
                                playSound('brick'); /* [cite: 134] */ /* [cite: 668] */
                                // Increase ball speed slightly as bricks are destroyed
                                let speedMultiplier = 1 + (bricksHit / totalBricks) * 0.3; /* [cite: 135] */ /* [cite: 669] */
                                let maxSpeed = 6 + level; /* [cite: 136] */ /* [cite: 670] */
                                if (!activePowerupType || activePowerupType !== 'slowBall') { /* [cite: 136] */
                                    if (ball.speedX > 0) { /* [cite: 136] */

  ball.speedX = Math.min(maxSpeed, 4 * speedMultiplier); /* [cite: 136] */ /* [cite: 671, 672] */
                                    } else { /* [cite: 137] */
                                        ball.speedX = Math.max(-maxSpeed, -4 * speedMultiplier); /* [cite: 137] */ /* [cite: 673] */
                                    } /* [cite: 138] */
                                    if (ball.speedY > 0) { /* [cite: 138] */

  ball.speedY = Math.min(maxSpeed, 4 * speedMultiplier); /* [cite: 139] */ /* [cite: 674, 675] */
                                    } else { /* [cite: 140] */
                                        ball.speedY = Math.max(-maxSpeed, -4 * speedMultiplier); /* [cite: 140] */ /* [cite: 676] */
                                    } /* [cite: 141] */
                                }

  // Check if level is complete /* cite: 142 */ /* [cite: 677] */
 if (bricksHit === totalBricks) { /* cite: 142 */
 levelComplete(); /* [cite: 678] */
 } /* cite: 143 */
 // Only process one collision per frame for this ball
 return; /* cite: 144 */ /* [cite: 679] */
 } // End of brick collision check
 } // End of b.status > 0 check
 } // End of row loop
 } // End of column loop
 } // End of loop through balls
 } // End of collisionDetection function

 // Fireball effect - destroy adjacent bricks
 function applyFireballEffect(x, y) {
 const radius = 50; /* [cite: 1163] */
 for (let c = 0; c < BRICK_COLUMNS; c++) {
 for (let r = 0; r < BRICK_ROWS; r++) {
 let b = bricks[c][r];
 if (b.status > 0) { /* [cite: 1164] */
 const brickCenterX = b.x + BRICK_WIDTH / 2;
 const brickCenterY = b.y + BRICK_HEIGHT / 2; /* [cite: 1165] */

 const distance = Math.sqrt(Math.pow(x - brickCenterX, 2) + Math.pow(y - brickCenterY, 2));
 if (distance < radius) { /* [cite: 1166] */
 let pointValue = 5 * level;
 score += Math.round(pointValue); /* [cite: 1167] */
 if (scoreDisplay) {
 scoreDisplay.textContent = `Score: ${score}`;
 } /* [cite: 1168] */

 createParticles(brickCenterX, brickCenterY, b.color);
 let hitPoints = b.status; /* [cite: 1169] */
 b.status = 0;
 bricksHit += hitPoints;
 if (bricksHit >= totalBricks) { /* [cite: 1170] */
 levelComplete();
 } /* [cite: 1171] */
 }
 }
 }
 }
 }

        // Particle system
        function createParticles(x, y, color) { /* [cite: 145] */

  for (let i = 0; i < 12; i++) { /* [cite: 145] */ /* [cite: 680] */
                particles.push({ /* [cite: 145] */
                    x: x,
                    y: y,

  vx: (Math.random() - 0.5) * 8, /* [cite: 146] */ /* [cite: 681] */
                    vy: (Math.random() - 0.5) * 8,
                    radius: Math.random() * 4 + 1,
                    color: color,

  alpha: 1, /* [cite: 147] */ /* [cite: 682] */
                    life: Math.random() * 40 + 20
                }); /* [cite: 147] */ /* [cite: 683] */
            } /* [cite: 148] */
        }
        function updateParticles() {
            for (let i = particles.length - 1; i >= 0; i--) { /* [cite: 148] */
                let p = particles[i]; /* [cite: 148] */ /* [cite: 684] */
                p.x += p.vx; /* [cite: 149] */ /* [cite: 685] */
                p.y += p.vy; /* [cite: 149] */ /* [cite: 686] */
                p.vx *= 0.98; /* [cite: 149] */ /* [cite: 687] */
 // Slight deceleration /* [cite: 149] */
                p.vy *= 0.98; /* [cite: 149] */ /* [cite: 688] */
                p.alpha = p.life / 60; /* [cite: 150] */ /* [cite: 689] */
                p.life--; /* [cite: 150] */ /* [cite: 690] */
                if (p.life <= 0) { /* [cite: 150] */
                    particles.splice(i, 1); /* [cite: 150] */ /* [cite: 691] */
                } /* [cite: 151] */
            }
        }
        function drawParticles() {
            for (let i = 0; i < particles.length; i++) { /* [cite: 151] */
                let p = particles[i]; /* [cite: 151] */ /* [cite: 692] */
                ctx.globalAlpha = p.alpha; /* [cite: 152] */ /* [cite: 693] */
                ctx.beginPath(); /* [cite: 152] */ /* [cite: 694] */
                ctx.arc(p.x, p.y, p.radius, 0, Math.PI * 2); /* [cite: 152] */ /* [cite: 695] */
                ctx.fillStyle = p.color; /* [cite: 152] */ /* [cite: 696] */
                ctx.fill(); /* [cite: 152] */ /* [cite: 697] */
                // Add a glow effect to particles
                ctx.beginPath(); /* [cite: 153] */ /* [cite: 698] */
                ctx.arc(p.x, p.y, p.radius + 2, 0, Math.PI * 2); /* [cite: 154] */ /* [cite: 699] */
                ctx.strokeStyle = p.color; /* [cite: 154] */ /* [cite: 700] */
                ctx.lineWidth = 1; /* [cite: 154] */ /* [cite: 701] */
                ctx.stroke(); /* [cite: 154] */ /* [cite: 702] */
            } /* [cite: 155] */
            ctx.globalAlpha = 1; /* [cite: 155] */ /* [cite: 703] */
        } /* [cite: 156] */
        // Simple sound system with different sound effects
        function playSound(type) {
            if (!soundEnabled) return; /* [cite: 156] */ /* [cite: 704] */
            try { /* [cite: 157] */
                let settings = { /* [cite: 157] */
                    frequency: 440,
                    duration: 100,

  type: 'sine', /* [cite: 705] */
                    volume: 0.1 /* [cite: 158] */
                }; /* [cite: 158] */ /* [cite: 706] */
                switch(type) { /* [cite: 159] */
                    case 'paddle':
                        settings.frequency = 220; /* [cite: 159] */ /* [cite: 707] */
                        settings.duration = 100; /* [cite: 160] */ /* [cite: 708] */
                        settings.type = 'sine'; /* [cite: 160] */ /* [cite: 709] */
                        break; /* [cite: 710] */
 case 'brick':
                        settings.frequency = 440; /* [cite: 160] */ /* [cite: 711] */
                        settings.duration = 100; /* [cite: 161] */ /* [cite: 712] */
                        settings.type = 'square'; /* [cite: 161] */ /* [cite: 713] */
                        break; /* [cite: 714] */
 case 'wall':
                        settings.frequency = 330; /* [cite: 161] */ /* [cite: 715] */
                        settings.duration = 50; /* [cite: 162] */ /* [cite: 716] */
                        settings.type = 'sine'; /* [cite: 162] */ /* [cite: 717] */
                        break; /* [cite: 718] */
 case 'death':
                        settings.frequency = 110; /* [cite: 162] */ /* [cite: 719] */
                        settings.duration = 300; /* [cite: 163] */ /* [cite: 720] */
                        settings.type = 'sawtooth'; /* [cite: 163] */ /* [cite: 721] */
                        settings.volume = 0.2; /* [cite: 163] */ /* [cite: 722] */
                        break; /* [cite: 723] */
 case 'levelComplete': /* [cite: 164] */
                        settings.frequency = 660; /* [cite: 164] */ /* [cite: 724] */
                        settings.duration = 500; /* [cite: 165] */ /* [cite: 725] */
                        settings.type = 'sine'; /* [cite: 165] */ /* [cite: 726] */
                        settings.volume = 0.2; /* [cite: 165] */ /* [cite: 727] */
                        break; /* [cite: 728] */
 case 'powerup': /* [cite: 166] */
                        settings.frequency = 880; /* [cite: 166] */ /* [cite: 729] */
                        settings.duration = 200; /* [cite: 167] */ /* [cite: 730] */
                        settings.type = 'sine'; /* [cite: 167] */ /* [cite: 731] */
                        break; /* [cite: 732] */
 default:
                        return; /* [cite: 167] */ /* [cite: 733] */
                } /* [cite: 168] */
                const AudioContext = window.AudioContext || /* [cite: 168] */ /* [cite: 734] */
                                   window.webkitAudioContext; /* [cite: 169] */ /* [cite: 735] */
                const context = new AudioContext(); /* [cite: 169] */ /* [cite: 736] */
                const oscillator = context.createOscillator(); /* [cite: 169] */ /* [cite: 737] */
                const gainNode = context.createGain(); /* [cite: 169] */ /* [cite: 738] */
                oscillator.connect(gainNode); /* [cite: 169] */ /* [cite: 739] */
                gainNode.connect(context.destination); /* [cite: 169] */ /* [cite: 740] */
                oscillator.type = settings.type; /* [cite: 169] */ /* [cite: 741] */
                oscillator.frequency.value = settings.frequency; /* [cite: 170] */ /* [cite: 742] */
                gainNode.gain.setValueAtTime(settings.volume, context.currentTime); /* [cite: 170] */ /* [cite: 743] */
                gainNode.gain.exponentialRampToValueAtTime(0.01, context.currentTime + settings.duration / 1000); /* [cite: 170] */ /* [cite: 744] */
                oscillator.start(); /* [cite: 170] */ /* [cite: 745] */
                oscillator.stop(context.currentTime + settings.duration / 1000); /* [cite: 170] */ /* [cite: 746] */
            } catch (e) { /* [cite: 171] */
                // Silently fail if audio context cannot be created
                debug("Audio not supported: " + e.message); /* [cite: 171] */ /* [cite: 747] */
            } /* [cite: 172] */
        }
        // Screen effects
        function flashScreen() {
            if (screenFlash) { /* [cite: 172] */
                screenFlash.style.opacity = 0.7; /* [cite: 172] */ /* [cite: 748] */
                setTimeout(() => { /* [cite: 173] */
                    screenFlash.style.opacity = 0; /* [cite: 173] */
                }, 100); /* [cite: 173] */ /* [cite: 749] */
            } /* [cite: 174] */
        }
        function shakeScreen() {
            const gameContainer = document.getElementById('game-container'); /* [cite: 174] */ /* [cite: 750] */
            if (gameContainer && !screenShaking) { /* [cite: 175] */
                screenShaking = true; /* [cite: 175] */ /* [cite: 751] */
                gameContainer.classList.add('shaking'); /* [cite: 176] */ /* [cite: 752] */
                setTimeout(() => { /* [cite: 176] */
                    gameContainer.classList.remove('shaking'); /* [cite: 176] */
                    screenShaking = false; /* [cite: 176] */
                }, 500); /* [cite: 176] */ /* [cite: 753] */
            } /* [cite: 177] */
        }
        // Power-ups system with expanded options
        const POWERUP_TYPES = [ /* [cite: 177] */
            { type: 'extraLife', color: '#FF5555', text: '  ❤️  ', chance: 0.15 },
            { type: 'widenPaddle', color: '#55FF55', text:'  ⬅️➡️  ', chance: 0.25 },
            { type: 'slowBall', color: '#5555FF', text: '  🐢  ', chance: 0.25 }, /* [cite: 178] */
            { type: 'multiball', color: '#FFAA00', text: '  🔄  ', chance: 0.2 },
            { type: 'fireball', color: '#FF0000', text: '  🔥  ', chance: 0.15 }
        ]; /* [cite: 178] */ /* [cite: 755] */
        function createPowerup(x, y) { /* [cite: 179] */
            // Calculate total chance pool
            let totalChance = 0; /* [cite: 179] */ /* [cite: 756] */
            for (let i = 0; i < POWERUP_TYPES.length; i++) { /* [cite: 180] */
                totalChance += POWERUP_TYPES[i].chance; /* [cite: 180] */ /* [cite: 757] */
            } /* [cite: 181] */
            // 40% overall chance to create a power-up when a brick is destroyed
            // Higher chance in higher levels
            let powerupChance = 0.3 + (level - 1) * 0.05; /* [cite: 181] */ /* [cite: 758] */
            if (Math.random() < powerupChance) { /* [cite: 182] */
                // Select a random power-up weighted by their chance values
                let randomValue = Math.random() * totalChance; /* [cite: 182] */ /* [cite: 759] */
                let cumulativeChance = 0; /* [cite: 183] */ /* [cite: 760] */
                let selectedType = POWERUP_TYPES[0]; /* [cite: 183] */ /* [cite: 761] */
                for (let i = 0; i < POWERUP_TYPES.length; i++) { /* [cite: 183] */
                    cumulativeChance += POWERUP_TYPES[i].chance; /* [cite: 183] */ /* [cite: 762] */
                    if (randomValue <= cumulativeChance) { /* [cite: 184] */
                        selectedType = POWERUP_TYPES[i]; /* [cite: 184] */ /* [cite: 763] */
                        break; /* [cite: 185] */ /* [cite: 764] */
                    }
                }
                powerups.push({ /* [cite: 185] */

  y: y, /* [cite: 765] */
                    type: selectedType.type, /* [cite: 186] */
                    color: selectedType.color,
                    text: selectedType.text,
                    width: 30,


  height: 30, /* [cite: 766] */
                    speed: 1 + level * 0.3 /* [cite: 187] */
                }); /* [cite: 187] */ /* [cite: 767] */
                debug(`Created ${selectedType.type} powerup`); /* [cite: 188] */ /* [cite: 768] */
            }
        }
        function updatePowerups() {
            for (let i = powerups.length - 1; i >= 0; i--) { /* [cite: 188] */
                let p = powerups[i]; /* [cite: 188] */ /* [cite: 769] */
                p.y += p.speed; /* [cite: 189] */ /* [cite: 770] */
                // Check if power-up is caught by paddle
                if ( /* [cite: 189] */
                    p.y + p.height > canvas.height - PADDLE_HEIGHT &&
                    p.y < canvas.height &&

  p.x + p.width > paddleX && /* [cite: 190] */ /* [cite: 771] */
                    p.x < paddleX + PADDLE_WIDTH
                ) {
                    // Activate power-up


  activatePowerup(p.type); /* [cite: 772, 773] */
                    powerups.splice(i, 1); /* [cite: 191] */ /* [cite: 774] */
                    playSound('powerup'); /* [cite: 191] */ /* [cite: 775] */
                }
                // Remove if falls below screen
                else if (p.y > canvas.height) { /* [cite: 191] */
                    powerups.splice(i, 1); /* [cite: 191] */ /* [cite: 776] */
                } /* [cite: 192] */
            }
            // Handle power-up timer
            if (powerupActive) { /* [cite: 192] */
                powerupTimer -= 1; /* [cite: 192] */ /* [cite: 777] */
                if (powerupTimer <= 0) { /* [cite: 193] */
                    deactivatePowerup(); /* [cite: 193] */ /* [cite: 778] */
                } /* [cite: 194] */
            }
        }
        function activatePowerup(type) {
            // Deactivate current power-up if there is one
            if (powerupActive && type !== 'extraLife' && type !== 'multiball') { /* [cite: 194] */

  deactivatePowerup(); /* [cite: 194] */ /* [cite: 779, 780] */
            } /* [cite: 195] */
            powerupActive = true; /* [cite: 195] */ /* [cite: 781] */
            activePowerupType = type; /* [cite: 196] */ /* [cite: 782] */
            powerupTimer = 600; /* [cite: 196] */ /* [cite: 783] */
 // 10 seconds at 60fps /* [cite: 196] */
            debug(`Activated ${type} powerup`); /* [cite: 196] */ /* [cite: 784] */
            flashScreen(); /* [cite: 197] */ /* [cite: 785] */
            switch (type) { /* [cite: 197] */
                case 'extraLife':
                    lives++; /* [cite: 197] */ /* [cite: 786] */
                    if (livesDisplay) { /* [cite: 198] */
                        livesDisplay.textContent = `Lives: ${lives}`; /* [cite: 198] */ /* [cite: 787] */
                    } /* [cite: 199] */
                    powerupActive = false; /* [cite: 199] */ /* [cite: 788] */
                    // This power-up has immediate effect
                    break; /* [cite: 200] */ /* [cite: 789] */
                case 'widenPaddle': /* [cite: 201] */
                    PADDLE_WIDTH = paddleWidthWide; /* [cite: 201] */ /* [cite: 790] */
                    break; /* [cite: 202] */ /* [cite: 791] */
                case 'slowBall':
                    // Slow down all balls
                    for (let i = 0; i < balls.length; i++) { /* [cite: 202] */


  let ball = balls[i]; /* [cite: 202] */ /* [cite: 792] */
                        let currentSpeedRatio = ball.speedX / Math.abs(ball.speedX); /* [cite: 203] */ /* [cite: 793] */
                        ball.speedX = ballSpeedSlow * currentSpeedRatio; /* [cite: 203] */ /* [cite: 794] */
                        currentSpeedRatio = ball.speedY / Math.abs(ball.speedY); /* [cite: 203] */ /* [cite: 795] */
                        ball.speedY = ballSpeedSlow * currentSpeedRatio; /* [cite: 204] */ /* [cite: 796] */
                    }
                    break; /* [cite: 204] */ /* [cite: 797] */
                case 'multiball': /* [cite: 205] */
                    // Add two more balls
                    if (balls.length < 3) { // Limit to 3 balls max /* [cite: 205] */

  const mainBall = balls[0]; /* [cite: 205] */ /* [cite: 798, 799] */
                        // Create two new balls at slightly different angles
                        for (let i = 0; i < 2; i++) { /* [cite: 206] */

  let angle = Math.PI * (0.4 + i * 0.2); /* [cite: 206] */ /* [cite: 800, 801] */
                            // 40° and 60° angles
                            let speed = Math.sqrt(mainBall.speedX * mainBall.speedX + mainBall.speedY * mainBall.speedY); /* [cite: 207] */ /* [cite: 802] */
                            balls.push({ /* [cite: 208] */
                                x: mainBall.x,


  y: mainBall.y, /* [cite: 803] */
                                speedX: speed * Math.cos(angle) * (i % 2 === 0 ? 1 : -1), /* [cite: 209] */
                                speedY: -speed * Math.sin(angle),

  radius: BALL_RADIUS, /* [cite: 804] */
                                fireball: mainBall.fireball /* [cite: 210] */
                            }); /* [cite: 210] */ /* [cite: 805] */
                        } /* [cite: 211] */
                        multiballActive = true; /* [cite: 211] */ /* [cite: 806] */
                    } /* [cite: 212] */
                    powerupActive = false; /* [cite: 212] */ /* [cite: 807] */
                    // This power-up has immediate effect
                    break; /* [cite: 213] */ /* [cite: 808] */
                case 'fireball': /* [cite: 214] */
                    // Fireball destroys adjacent bricks
                    // We'll implement this effect in the collision detection
                    for (let i = /* [cite: 809] */
 0; i < balls.length; i++) { /* [cite: 214] */
                        balls[i].fireball = true; /* [cite: 215] */ /* [cite: 810] */
                    }
                    break; /* [cite: 215] */ /* [cite: 811] */
            } /* [cite: 216] */
        }
        function deactivatePowerup() {
            if (!powerupActive) return; /* [cite: 216] */ /* [cite: 812] */
            debug(`Deactivated ${activePowerupType} powerup`); /* [cite: 217] */ /* [cite: 813] */
            powerupActive = false; /* [cite: 217] */ /* [cite: 814] */
            switch (activePowerupType) { /* [cite: 217] */
                case 'widenPaddle':
                    PADDLE_WIDTH = paddleWidthNormal; /* [cite: 217] */ /* [cite: 815] */
                    // Make sure paddle doesn't go out of bounds
                    if (paddleX + PADDLE_WIDTH > canvas.width) { /* [cite: 218] */
                        paddleX = canvas.width - PADDLE_WIDTH; /* [cite: 218] */ /* [cite: 816] */
                    } /* [cite: 219] */
                    break; /* [cite: 817] */
 case 'slowBall': /* [cite: 220] */
                    // Restore normal speed but keep direction for all balls
                    for (let i = 0; i < balls.length; i++) { /* [cite: 220] */
                        let ball = balls[i]; /* [cite: 220] */ /* [cite: 818] */
                        let currentSpeedRatio = ball.speedX / Math.abs(ball.speedX); /* [cite: 221] */ /* [cite: 819] */
                        ball.speedX = ballSpeedNormal * currentSpeedRatio; /* [cite: 221] */ /* [cite: 820] */
                        currentSpeedRatio = ball.speedY / Math.abs(ball.speedY); /* [cite: 221] */ /* [cite: 821] */
                        ball.speedY = ballSpeedNormal * currentSpeedRatio; /* [cite: 222] */ /* [cite: 822] */
                    }
                    break; /* [cite: 222] */ /* [cite: 823] */
                case 'fireball': /* [cite: 223] */
                    // Remove fireball effect from all balls
                    for (let i = 0; i < balls.length; i++) { /* [cite: 223] */

  balls[i].fireball = false; /* [cite: 223] */ /* [cite: 824, 825] */
                    } /* [cite: 224] */
                    break; /* [cite: 826] */
 } /* [cite: 225] */
            activePowerupType = null; /* [cite: 225] */ /* [cite: 827] */
        } /* [cite: 226] */
        function drawPowerups() {
            for (let i = 0; i < powerups.length; i++) { /* [cite: 226] */
                let p = powerups[i]; /* [cite: 226] */ /* [cite: 828] */
                // Draw power-up background
                ctx.beginPath(); /* [cite: 227] */ /* [cite: 829] */
                if (ctx.roundRect) { /* [cite: 228] */
                    ctx.roundRect(p.x, p.y, p.width, p.height, 5); /* [cite: 228] */ /* [cite: 830] */
                } else { /* [cite: 229] */
                    ctx.rect(p.x, p.y, p.width, p.height); /* [cite: 229] */ /* [cite: 831] */
                } /* [cite: 230] */
                ctx.fillStyle = p.color; /* [cite: 230] */ /* [cite: 832] */
                ctx.fill(); /* [cite: 230] */ /* [cite: 833] */
                // Draw power-up text/icon
                ctx.font = '18px Arial'; /* [cite: 231] */ /* [cite: 834] */
                ctx.textAlign = 'center'; /* [cite: 232] */ /* [cite: 835] */
                ctx.textBaseline = 'middle'; /* [cite: 232] */ /* [cite: 836] */
                ctx.fillStyle = 'white'; /* [cite: 232] */ /* [cite: 837] */
                ctx.fillText(p.text, p.x + p.width / 2, p.y + p.height / 2); /* [cite: 232] */ /* [cite: 838] */
                // Draw a glow effect
                ctx.beginPath(); /* [cite: 233] */ /* [cite: 839] */
                if (ctx.roundRect) { /* [cite: 234] */
                    ctx.roundRect(p.x - 2, p.y - 2, p.width + 4, p.height + 4, 7); /* [cite: 234] */ /* [cite: 840] */
                } else { /* [cite: 235] */
                    ctx.rect(p.x - 2, p.y - 2, p.width + 4, p.height + 4); /* [cite: 235] */ /* [cite: 841] */
                } /* [cite: 236] */
                ctx.strokeStyle = 'rgba(255, 255, 255, 0.5)'; /* [cite: 236] */ /* [cite: 842] */
                ctx.lineWidth = 2; /* [cite: 237] */ /* [cite: 843] */
                ctx.stroke(); /* [cite: 237] */ /* [cite: 844] */
            }
            // Draw active power-up indicator
            if (powerupActive) { /* [cite: 237] */
                let indicator = ''; /* [cite: 237] */ /* [cite: 845] */
                let color = 'white'; /* [cite: 238] */ /* [cite: 846] */
                switch (activePowerupType) { /* [cite: 238] */
                    case 'widenPaddle':
                        indicator = '  ⬅️➡️  '; /* [cite: 238] */ /* [cite: 847] */
                        color = '#55FF55'; /* [cite: 239] */ /* [cite: 848] */
                        break; /* [cite: 849] */
 case 'slowBall':
                        indicator = '  🐢  '; /* [cite: 239] */ /* [cite: 850] */
                        color = '#5555FF'; /* [cite: 240] */ /* [cite: 851] */
                        break; /* [cite: 852] */
 case 'fireball':
                        indicator = '  🔥  '; /* [cite: 240] */ /* [cite: 853] */
                        color = '#FF0000'; /* [cite: 241] */ /* [cite: 854] */
                        break; /* [cite: 855] */
 }
                if (indicator) { /* [cite: 241] */
                    ctx.font = '24px Arial'; /* [cite: 241] */ /* [cite: 856] */
                    ctx.textAlign = 'center'; /* [cite: 242] */ /* [cite: 857] */
                    ctx.fillStyle = color; /* [cite: 242] */ /* [cite: 858] */
                    ctx.fillText(indicator, paddleX + PADDLE_WIDTH / 2, canvas.height - PADDLE_HEIGHT - 15); /* [cite: 242] */ /* [cite: 859] */
                    // Draw timer bar
                    const barWidth = 60; /* [cite: 243] */ /* [cite: 860] */
                    const barHeight = 5; /* [cite: 244] */ /* [cite: 861] */
                    const x = paddleX + PADDLE_WIDTH / 2 - barWidth / 2; /* [cite: 244] */ /* [cite: 862] */
                    const y = canvas.height - PADDLE_HEIGHT - 10; /* [cite: 245] */ /* [cite: 863] */
                    // Background
                    ctx.fillStyle = 'rgba(0, 0, 0, 0.5)'; /* [cite: 245] */ /* [cite: 864] */
                    ctx.fillRect(x, y, barWidth, barHeight); /* [cite: 246] */ /* [cite: 865] */
                    // Fill based on remaining time
                    ctx.fillStyle = color; /* [cite: 246] */ /* [cite: 866] */
                    ctx.fillRect(x, y, barWidth * (powerupTimer / 600), barHeight); /* [cite: 247] */ /* [cite: 867] */
                }
            }
        }
        // Background with stars
        function drawBackground() {
            // Draw a gradient background
            let bgGradient = ctx.createLinearGradient(0, 0, 0, canvas.height); /* [cite: 247] */ /* [cite: 868] */
            bgGradient.addColorStop(0, themes[currentTheme].background.start); /* [cite: 248] */ /* [cite: 869] */
            bgGradient.addColorStop(1, themes[currentTheme].background.end); /* [cite: 248] */ /* [cite: 870] */
            ctx.fillStyle = bgGradient; /* [cite: 248] */ /* [cite: 871] */
            ctx.fillRect(0, 0, canvas.width, canvas.height); /* [cite: 248] */ /* [cite: 872] */
            // Draw stars
            for (let i = 0; i < stars.length; i++) { /* [cite: 249] */
                let star = stars[i]; /* [cite: 249] */ /* [cite: 873] */
                ctx.beginPath(); /* [cite: 250] */ /* [cite: 874] */
                ctx.arc(star.x, star.y, star.radius, 0, Math.PI * 2); /* [cite: 250] */ /* [cite: 875] */
                ctx.fillStyle = `rgba(255, 255, 255, ${star.brightness})`; /* [cite: 250] */ /* [cite: 876] */
                ctx.fill(); /* [cite: 250] */ /* [cite: 877] */
            } /* [cite: 251] */
        }
        function createStars() {
            stars = []; /* [cite: 251] */ /* [cite: 878] */
            for (let i = 0; i < 100; i++) { /* [cite: 252] */
                stars.push({ /* [cite: 252] */
                    x: Math.random() * canvas.width,
                    y: Math.random() * canvas.height,

  radius: Math.random() * 1.5, /* [cite: 879] */
                    brightness: Math.random() * 0.5 + 0.5, /* [cite: 253] */
                    blinkSpeed: Math.random() * 0.05
                }); /* [cite: 253] */ /* [cite: 880] */
            } /* [cite: 254] */
            debug("Created starry background"); /* [cite: 254] */ /* [cite: 881] */
        } /* [cite: 255] */
        function updateStars() {
            for (let i = 0; i < stars.length; i++) { /* [cite: 255] */
                let star = stars[i]; /* [cite: 255] */ /* [cite: 882] */
                star.brightness += star.blinkSpeed; /* [cite: 256] */ /* [cite: 883] */
                if (star.brightness > 1 || star.brightness < 0.5) { /* [cite: 256] */
                    star.blinkSpeed = -star.blinkSpeed; /* [cite: 256] */ /* [cite: 884] */
                } /* [cite: 257] */
            }
        }
        function draw(timestamp) {
            if (!gameStarted || gamePaused) return; /* [cite: 257] */ /* [cite: 885] */
            // Calculate delta time and FPS
            if (!lastFrameTime) { /* [cite: 258] */
                lastFrameTime = timestamp; /* [cite: 258] */ /* [cite: 886] */
            } /* [cite: 259] */
            const deltaTime = timestamp - lastFrameTime; /* [cite: 259] */ /* [cite: 887] */
            lastFrameTime = timestamp; /* [cite: 260] */ /* [cite: 888] */
            // Update game time
            gameTime += deltaTime; /* [cite: 260] */ /* [cite: 889] */
            // Calculate FPS
            frameCount++; /* [cite: 261] */ /* [cite: 890] */
            if (timestamp - lastFpsUpdate > 1000) { /* [cite: 262] */
                fps = Math.round(frameCount * 1000 / (timestamp - lastFpsUpdate)); /* [cite: 262] */ /* [cite: 891] */
                lastFpsUpdate = timestamp; /* [cite: 263] */ /* [cite: 892] */
                frameCount = 0; /* [cite: 263] */ /* [cite: 893] */
                if (fpsDisplay) { /* [cite: 263] */
                    fpsDisplay.textContent = `FPS: ${fps}`; /* [cite: 263] */ /* [cite: 894] */
                } /* [cite: 264] */
            }
            // Clear the canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height); /* [cite: 264] */ /* [cite: 895] */
            // Draw background with stars
            drawBackground(); /* [cite: 265] */ /* [cite: 896] */
            updateStars(); /* [cite: 265] */ /* [cite: 897] */
            // Draw game elements
            drawBricks(); /* [cite: 266] */ /* [cite: 898] */
            drawBall(); /* [cite: 266] */ /* [cite: 899] */
            drawPaddle(); /* [cite: 266] */ /* [cite: 900] */
            drawParticles(); /* [cite: 266] */ /* [cite: 901] */
            drawPowerups(); /* [cite: 266] */ /* [cite: 902] */
            // Update particles and power-ups
            updateParticles(); /* [cite: 267] */ /* [cite: 903] */
            updatePowerups(); /* [cite: 267] */ /* [cite: 904] */
            // Decrement combo timer
            if (comboTimer > 0) { /* [cite: 268] */
                comboTimer--; /* [cite: 268] */ /* [cite: 905] */
                if (comboTimer === 0) { /* [cite: 269] */
                    combo = 0; /* [cite: 269] */ /* [cite: 906] */
                    comboDisplay.style.opacity = "0"; /* [cite: 270] */ /* [cite: 907] */
                }
            }
            // Collision detection
            collisionDetection(); /* [cite: 270] */ /* [cite: 908] */
            // Process each ball
            for (let i = balls.length - 1; i >= 0; i--) { /* [cite: 271] */
                let ball = balls[i]; /* [cite: 271] */ /* [cite: 909] */
                // Ball and wall collisions
                if (ball.x + ball.speedX > canvas.width - ball.radius || ball.x + ball.speedX < ball.radius) { /* [cite: 272] */
                    ball.speedX = -ball.speedX; /* [cite: 272] */ /* [cite: 910] */
                    playSound('wall'); /* [cite: 273] */ /* [cite: 911] */
                }
                if (ball.y + ball.speedY < ball.radius) { /* [cite: 273] */
                    ball.speedY = -ball.speedY; /* [cite: 273] */ /* [cite: 912] */
                    playSound('wall'); /* [cite: 274] */ /* [cite: 913] */
                }
                // Paddle collision
                if ( /* [cite: 274] */
                    ball.y + ball.speedY > canvas.height - PADDLE_HEIGHT - ball.radius &&

  ball.x > paddleX && /* [cite: 275] */ /* [cite: 914] */
                    ball.x < paddleX + PADDLE_WIDTH
                ) {
                    // Calculate bounce angle based on where ball hits the paddle

  let hitPos = (ball.x - (paddleX + PADDLE_WIDTH / 2)) / (PADDLE_WIDTH / 2); /* [cite: 915, 916] */
                    let bounceAngle = hitPos * Math.PI / 3; /* [cite: 276] */ /* [cite: 917] */
                    // Max 60 degrees
                    let speed = Math.sqrt(ball.speedX * ball.speedX + ball.speedY * ball.speedY); /* [cite: 277] */ /* [cite: 918] */
                    ball.speedX = speed * Math.sin(bounceAngle); /* [cite: 278] */ /* [cite: 919] */
                    ball.speedY = -speed * Math.cos(bounceAngle); /* [cite: 278] */ /* [cite: 920] */
                    paddleHits++; /* [cite: 278] */ /* [cite: 921] */
                    playSound('paddle'); /* [cite: 278] */ /* [cite: 922] */
                    createParticles(ball.x, ball.y, themes[currentTheme].particles.paddle); /* [cite: 278] */ /* [cite: 923] */
                } /* [cite: 279] */
                // Ball falls below screen
                if (ball.y + ball.speedY > canvas.height) { /* [cite: 279] */
                    // Only remove this ball if we have multiple balls

  if (balls.length > 1) { /* [cite: 280] */ /* [cite: 924] */
                        balls.splice(i, 1); /* [cite: 280] */ /* [cite: 925] */
                        continue; /* [cite: 281] */ /* [cite: 926] */
                    } else { /* [cite: 281] */
                        // Last ball - lose a life
                        lives--; /* [cite: 281] */ /* [cite: 927] */
                        if (livesDisplay) { /* [cite: 282] */
                            livesDisplay.textContent = `Lives: ${lives}`; /* [cite: 282] */ /* [cite: 928] */
                        } /* [cite: 283] */
                        playSound('death'); /* [cite: 283] */ /* [cite: 929] */
                        flashScreen(); /* [cite: 284] */ /* [cite: 930] */
                        shakeScreen(); /* [cite: 284] */ /* [cite: 931] */
                        if (lives <= 0) { /* [cite: 284] */
                            gameOver(); /* [cite: 284] */ /* [cite: 932] */
                        } else { /* [cite: 285] */
                            // Reset ball position
                            ball.x = canvas.width / 2; /* [cite: 285] */ /* [cite: 933] */
                            ball.y = canvas.height - PADDLE_HEIGHT - ball.radius - 10; /* [cite: 286] */ /* [cite: 934] */
                            ball.speedX = 4 * (Math.random() > 0.5 ? 1 : -1); /* [cite: 286] */ /* [cite: 935] */
                            ball.speedY = -4; /* [cite: 287] */ /* [cite: 936] */
                            // Reset paddle position
                            paddleX = (canvas.width - PADDLE_WIDTH) / 2; /* [cite: 287] */ /* [cite: 937] */
                            // Reset multiball
                            if (multiballActive) { /* [cite: 288] */
                                balls /* [cite: 938] */
 = [ball]; /* [cite: 288] */
                                // Keep only the main ball
                                multiballActive = false; /* [cite: 289] */ /* [cite: 939] */
                            } /* [cite: 290] */
                        }
                    }
                }

  // Update ball position /* [cite: 940] */
                ball.x += ball.speedX; /* [cite: 291] */ /* [cite: 941] */
                ball.y += ball.speedY; /* [cite: 291] */ /* [cite: 942] */
                // Fireball effect - leave a trail of particles
                if (ball.fireball) { /* [cite: 292] */
                    createParticles(ball.x, ball.y, '#ff4400'); /* [cite: 292] */ /* [cite: 943] */
                } /* [cite: 293] */
            }
            // Move paddle with keyboard
            if (rightPressed) { /* [cite: 293] */
                paddleX += 7; /* [cite: 293] */ /* [cite: 944] */
                if (paddleX + PADDLE_WIDTH > canvas.width) { /* [cite: 294] */
                    paddleX = canvas.width - PADDLE_WIDTH; /* [cite: 294] */ /* [cite: 945] */
                } /* [cite: 295] */
            } else if (leftPressed) { /* [cite: 295] */
                paddleX -= 7; /* [cite: 295] */ /* [cite: 946] */
                if (paddleX < 0) { /* [cite: 296] */
                    paddleX = 0; /* [cite: 296] */ /* [cite: 947] */
                } /* [cite: 297] */
            }
            // Continue animation
            requestAnimationFrame(draw); /* [cite: 297] */ /* [cite: 948] */
        } /* [cite: 298] */
        function startGame() {
            debug("Starting game..."); /* [cite: 298] */ /* [cite: 949] */
            if (!canvas || !ctx) { /* [cite: 299] */
                if (!initializeElements()) { /* [cite: 299] */
                    alert("Could not initialize game elements. Please reload the page."); /* [cite: 299] */ /* [cite: 950] */
                    return; /* [cite: 300] */ /* [cite: 951] */
                }
            }
            gameStarted = true; /* [cite: 300] */ /* [cite: 952] */
            if (startScreen) { /* [cite: 301] */
                startScreen.style.display = "none"; /* [cite: 301] */ /* [cite: 953] */
            } else { /* [cite: 302] */
                debug("Warning: Start screen element not found"); /* [cite: 302] */ /* [cite: 954] */
            } /* [cite: 303] */
            startTime = performance.now(); /* [cite: 303] */ /* [cite: 955] */
            lastFrameTime = performance.now(); /* [cite: 304] */ /* [cite: 956] */
            // Reset game variables to ensure fresh start
            score = 0; /* [cite: 304] */ /* [cite: 957] */
            lives = 3; /* [cite: 305] */ /* [cite: 958] */
            level = 1; /* [cite: 305] */ /* [cite: 959] */
            bricksHit = 0; /* [cite: 305] */ /* [cite: 960] */
            paddleHits = 0; /* [cite: 305] */ /* [cite: 961] */
            combo = 0; /* [cite: 305] */ /* [cite: 962] */
            maxCombo = 0; /* [cite: 305] */ /* [cite: 963] */
            comboTimer = 0; /* [cite: 306] */ /* [cite: 964] */
            particles = []; /* [cite: 306] */ /* [cite: 965] */
            powerups = []; /* [cite: 306] */ /* [cite: 966] */
            if (scoreDisplay) scoreDisplay.textContent = `Score: ${score}`; /* [cite: 306] */ /* [cite: 967] */
            if (livesDisplay) livesDisplay.textContent = `Lives: ${lives}`; /* [cite: 307] */ /* [cite: 968] */
            if (levelDisplay) levelDisplay.textContent = `Level ${level}`; /* [cite: 307] */ /* [cite: 969] */
            // Reset ball and paddle positions
            ballX = canvas.width / 2; /* [cite: 308] */ /* [cite: 970] */
            ballY = canvas.height - PADDLE_HEIGHT - BALL_RADIUS - 10; /* [cite: 309] */ /* [cite: 971] */
            ballSpeedX = 4 * (Math.random() > 0.5 ? 1 : -1); /* [cite: 309] */ /* [cite: 972] */
            ballSpeedY = -4; /* [cite: 310] */ /* [cite: 973] */
            paddleX = (canvas.width - PADDLE_WIDTH) / 2; /* [cite: 310] */ /* [cite: 974] */
            // Reset balls array
            balls = [{ /* [cite: 311] */
                x: ballX,
                y: ballY,
                speedX: ballSpeedX,

  speedY: ballSpeedY, /* [cite: 975] */
                radius: BALL_RADIUS, /* [cite: 312] */
                fireball: false
            }]; /* [cite: 312] */ /* [cite: 976] */
            multiballActive = false; /* [cite: 313] */ /* [cite: 977] */
            createBricks(); /* [cite: 313] */ /* [cite: 978] */
            playMusic(); /* [cite: 313] */ /* [cite: 979] */
            // Start the game loop
            debug("Game started successfully!"); /* [cite: 313] */ /* [cite: 980] */
            requestAnimationFrame(draw); /* [cite: 314] */ /* [cite: 981] */
        }
        function restartGame() {
            debug("Restarting game..."); /* [cite: 314] */ /* [cite: 982] */
            if (gameOverScreen) { /* [cite: 315] */
                gameOverScreen.style.display = "none"; /* [cite: 315] */ /* [cite: 983] */
            } /* [cite: 316] */
            score = 0; /* [cite: 316] */ /* [cite: 984] */
            lives = 3; /* [cite: 317] */ /* [cite: 985] */
            level = 1; /* [cite: 317] */ /* [cite: 986] */
            bricksHit = 0; /* [cite: 317] */ /* [cite: 987] */
            paddleHits = 0; /* [cite: 317] */ /* [cite: 988] */
            combo = 0; /* [cite: 317] */ /* [cite: 989] */
            maxCombo = 0; /* [cite: 317] */ /* [cite: 990] */
            comboTimer = 0; /* [cite: 318] */ /* [cite: 991] */
            if (scoreDisplay) scoreDisplay.textContent = `Score: ${score}`; /* [cite: 318] */ /* [cite: 992] */
            if (livesDisplay) livesDisplay.textContent = `Lives: ${lives}`; /* [cite: 318] */ /* [cite: 993] */
            if (levelDisplay) levelDisplay.textContent = `Level ${level}`; /* [cite: 319] */ /* [cite: 994] */
            if (comboDisplay) comboDisplay.style.opacity = "0"; /* [cite: 319] */ /* [cite: 995] */
            // Reset ball and paddle positions
            ballX = canvas.width / 2; /* [cite: 320] */ /* [cite: 996] */
            ballY = canvas.height - PADDLE_HEIGHT - BALL_RADIUS - 10; /* [cite: 321] */ /* [cite: 997] */
            ballSpeedX = 4 * (Math.random() > 0.5 ? 1 : -1); /* [cite: 321] */ /* [cite: 998] */
            ballSpeedY = -4; /* [cite: 322] */ /* [cite: 999] */
            paddleX = (canvas.width - PADDLE_WIDTH) / 2; /* [cite: 322] */ /* [cite: 1000] */
            // Reset balls array
            balls = [{ /* [cite: 323] */
                x: ballX,
                y: ballY,
                speedX: ballSpeedX,

  speedY: ballSpeedY, /* [cite: 1001] */
                radius: BALL_RADIUS, /* [cite: 324] */
                fireball: false
            }]; /* [cite: 324] */ /* [cite: 1002] */
            multiballActive = false; /* [cite: 325] */ /* [cite: 1003] */
            // Clear particles & powerups
            particles = []; /* [cite: 325] */ /* [cite: 1004] */
            powerups = []; /* [cite: 326] */ /* [cite: 1005] */
            // Reset active powerups
            if (powerupActive) { /* [cite: 326] */
                deactivatePowerup(); /* [cite: 326] */ /* [cite: 1006] */
            } /* [cite: 327] */
            startTime = performance.now(); /* [cite: 327] */ /* [cite: 1007] */
            gameTime = 0; /* [cite: 328] */ /* [cite: 1008] */
            createBricks(); /* [cite: 328] */ /* [cite: 1009] */
            gameStarted = true; /* [cite: 328] */ /* [cite: 1010] */
            playMusic(); /* [cite: 328] */ /* [cite: 1011] */
            requestAnimationFrame(draw); /* [cite: 328] */ /* [cite: 1012] */
        }
        function nextLevel() {
            debug(`Starting level ${level+1}...`); /* [cite: 1] */ /* [cite: 1013] */
            if (levelCompleteScreen) { /* [cite: 2] */
                levelCompleteScreen.style.display = "none"; /* [cite: 2] */ /* [cite: 1014] */
            } /* [cite: 3] */
            level++; /* [cite: 3] */ /* [cite: 1015] */
            bricksHit = 0; /* [cite: 4] */ /* [cite: 1016] */
            paddleHits = 0; /* [cite: 4] */ /* [cite: 1017] */
            combo = 0; /* [cite: 4] */ /* [cite: 1018] */
            comboTimer = 0; /* [cite: 4] */ /* [cite: 1019] */
            if (levelDisplay) levelDisplay.textContent = `Level ${level}`; /* [cite: 4] */ /* [cite: 1020] */
            if (comboDisplay) comboDisplay.style.opacity = "0"; /* [cite: 5] */ /* [cite: 1021] */
            // Reset ball and paddle positions
            ballX = canvas.width / 2; /* [cite: 5] */ /* [cite: 1022] */
            ballY = canvas.height - PADDLE_HEIGHT - BALL_RADIUS - 10; /* [cite: 6] */ /* [cite: 1023] */
            // Increase base ball speed with level
            let baseSpeed = 4 + (level - 1) * 0.5; /* [cite: 6] */ /* [cite: 1024] */
            ballSpeedX = baseSpeed * (Math.random() > 0.5 ? 1 : -1); /* [cite: 7] */ /* [cite: 1025] */
            ballSpeedY = -baseSpeed; /* [cite: 7] */ /* [cite: 1026] */
            paddleX = (canvas.width - PADDLE_WIDTH) / 2; /* [cite: 8] */ /* [cite: 1027] */
            // Reset balls array
            balls = [{ /* [cite: 8] */
                x: ballX,
                y: ballY,
                speedX: ballSpeedX,

  speedY: ballSpeedY, /* [cite: 1028] */
                radius: BALL_RADIUS, /* [cite: 9] */
                fireball: false
            }];
 multiballActive = false; /* [cite: 10] */ /* [cite: 1029] */
            // Clear particles & powerups
            particles = []; /* [cite: 10] */ /* [cite: 1030] */
            powerups = []; /* [cite: 11] */ /* [cite: 1031] */
            // Reset active powerups
            if (powerupActive) { /* [cite: 11] */
                deactivatePowerup(); /* [cite: 11] */ /* [cite: 1032] */
            } /* [cite: 12] */
            createBricks(); /* [cite: 12] */ /* [cite: 1033] */
            // Change the music for the new level
            stopMusic(); /* [cite: 13] */ /* [cite: 1034] */
            playMusic(); /* [cite: 14] */ /* [cite: 1035] */
            gameStarted = true; /* [cite: 14] */ /* [cite: 1036] */
            requestAnimationFrame(draw); /* [cite: 14] */ /* [cite: 1037] */
        }
        function gameOver() {
            debug("Game over!"); /* [cite: 14] */ /* [cite: 1038] */
            gameStarted = false; /* [cite: 15] */ /* [cite: 1039] */
            stopMusic(); /* [cite: 15] */ /* [cite: 1040] */
            if (gameOverScreen) { /* [cite: 15] */
                gameOverScreen.style.display = "flex"; /* [cite: 15] */ /* [cite: 1041] */
                // Format game time
                let totalSeconds = Math.floor(gameTime / 1000); /* [cite: 16] */ /* [cite: 1042] */
                let minutes = Math.floor(totalSeconds / 60); /* [cite: 17] */ /* [cite: 1043] */
                let seconds = totalSeconds % 60; /* [cite: 17] */ /* [cite: 1044] */
                let timeString = `${minutes}m ${seconds}s`; /* [cite: 17] */ /* [cite: 1045] */
                if (finalScoreDisplay) finalScoreDisplay.textContent = `Final Score: ${score}`; /* [cite: 18] */ /* [cite: 1046] */
                if (gameStatsDisplay) { /* [cite: 18] */
                    gameStatsDisplay.innerHTML = `
                        Level: ${level}<br>
                        Bricks Destroyed: ${bricksHit}<br>

  Paddle Hits: ${paddleHits}<br> /* [cite: 19] */ /* [cite: 1047] */
                        Max Combo: x${maxCombo}<br>
                        Time Played: ${timeString}


  `; /* [cite: 19] */ /* [cite: 1048] */
                } /* [cite: 20] */
                // Check for high score
                const newHighScoreText = document.getElementById('new-high-score'); /* [cite: 20] */ /* [cite: 1049] */
                const nameInput = document.getElementById('name-input'); /* [cite: 21] */ /* [cite: 1050] */
                const saveScoreBtn = document.getElementById('save-score-button'); /* [cite: 21] */ /* [cite: 1051] */
                if (isHighScore(score)) { /* [cite: 21] */
                    if (newHighScoreText) newHighScoreText.style.display = 'block'; /* [cite: 21] */ /* [cite: 1052] */
                    if (nameInput) nameInput.style.display = 'block'; /* [cite: 22] */ /* [cite: 1053] */
                    if (saveScoreBtn) { /* [cite: 22] */
                        saveScoreBtn.style.display = 'block'; /* [cite: 22] */ /* [cite: 1054] */
                        saveScoreBtn.onclick = function() { /* [cite: 23] */
                            const name = nameInput.value.trim() || /* [cite: 23] */ /* [cite: 1055] */
                                          'Player'; /* [cite: 24] */ /* [cite: 1056] */
                            addHighScore(name, score, level); /* [cite: 24] */ /* [cite: 1057] */
                            // Hide input elements after saving
                            newHighScoreText.style.display = 'none'; /* [cite: 24] */ /* [cite: 1058] */
                            nameInput.style.display = 'none'; /* [cite: 25] */ /* [cite: 1059] */
                            saveScoreBtn.style.display = 'none'; /* [cite: 25] */ /* [cite: 1060] */
                            // Show updated high scores
                            displayHighScores(); /* [cite: 25] */ /* [cite: 1061] */
                            document.getElementById('high-scores').style.display = 'flex'; /* [cite: 26] */ /* [cite: 1062] */
                            gameOverScreen.style.display = 'none'; /* [cite: 26] */ /* [cite: 1063] */
                        }; /* [cite: 1064] */
 }
                } else {
                    if (newHighScoreText) newHighScoreText.style.display = 'none'; /* [cite: 26] */ /* [cite: 1065] */
                    if (nameInput) nameInput.style.display = 'none'; /* [cite: 27] */ /* [cite: 1066] */
                    if (saveScoreBtn) saveScoreBtn.style.display = 'none'; /* [cite: 27] */ /* [cite: 1067] */
                } /* [cite: 28] */
            } else {
                debug("Warning: Game over screen element not found"); /* [cite: 28] */ /* [cite: 1068] */
                alert(`Game Over! Final Score: ${score}`); /* [cite: 29] */ /* [cite: 1069] */
            }
        }
        function levelComplete() {
            debug(`Level ${level} complete!`); /* [cite: 29] */ /* [cite: 1070] */
            gameStarted = false; /* [cite: 30] */ /* [cite: 1071] */
            playSound('levelComplete'); /* [cite: 30] */ /* [cite: 1072] */
            if (levelCompleteScreen) { /* [cite: 30] */
                levelCompleteScreen.style.display = "flex"; /* [cite: 30] */ /* [cite: 1073] */
                // Format game time for this level
                let totalSeconds = Math.floor(gameTime / 1000); /* [cite: 31] */ /* [cite: 1074] */
                let minutes = Math.floor(totalSeconds / 60); /* [cite: 32] */ /* [cite: 1075] */
                let seconds = totalSeconds % 60; /* [cite: 32] */ /* [cite: 1076] */
                let timeString = `${minutes}m ${seconds}s`; /* [cite: 32] */ /* [cite: 1077] */
                // Calculate bonus points based on time, lives, and combo
                let timeBonus = Math.max(0, 500 - totalSeconds * 2); /* [cite: 33] */ /* [cite: 1078] */
                let lifeBonus = lives * 100; /* [cite: 34] */ /* [cite: 1079] */
                let levelBonus = level * 500; /* [cite: 34] */ /* [cite: 1080] */
                let comboBonus = maxCombo * 50; /* [cite: 34] */ /* [cite: 1081] */
                let totalBonus = timeBonus + lifeBonus + levelBonus + comboBonus; /* [cite: 35] */ /* [cite: 1082] */
                score += totalBonus; /* [cite: 35] */ /* [cite: 1083] */
                if (levelScoreDisplay) { /* [cite: 36] */
                    levelScoreDisplay.textContent = `Score: ${score} (+${totalBonus} bonus)`; /* [cite: 36] */ /* [cite: 1084] */
                } /* [cite: 37] */
                if (levelStatsDisplay) { /* [cite: 37] */
                    levelStatsDisplay.innerHTML = `
                        Level ${level} Complete!<br>

  Bricks Destroyed: ${bricksHit}<br> /* [cite: 38] */ /* [cite: 1085] */
                        Paddle Hits: ${paddleHits}<br>
                        Max Combo: x${maxCombo}<br>
                        Lives /* [cite: 1086] */
 Remaining: ${lives}<br>
                        Time Bonus: +${timeBonus}<br> /* [cite: 39] */
                        Lives Bonus: +${lifeBonus}<br>
                        Level Bonus: +${levelBonus}<br>

  Combo Bonus: +${comboBonus} /* [cite: 1087] */
                    `; /* [cite: 40] */ /* [cite: 1088] */
                } /* [cite: 41] */
                if (scoreDisplay) { /* [cite: 41] */
                    scoreDisplay.textContent = `Score: ${score}`; /* [cite: 41] */ /* [cite: 1089] */
                } /* [cite: 42] */
            } else {
                debug("Warning: Level complete screen element not found"); /* [cite: 42] */ /* [cite: 1090] */
                alert(`Level ${level} Complete! Score: ${score}`); /* [cite: 43] */ /* [cite: 1091] */
                nextLevel(); /* [cite: 43] */ /* [cite: 1092] */
            }
        }
        // Add click event listeners to buttons
        function setupButtonListeners() {
            debug("Setting up button listeners..."); /* [cite: 43] */ /* [cite: 1093] */
            // Start button
            const startButton = document.getElementById("start-button"); /* [cite: 44] */ /* [cite: 1094] */
            if (startButton) { /* [cite: 45] */
                startButton.addEventListener("click", function() { /* [cite: 45] */
                    debug("Start button clicked"); /* [cite: 45] */
                    startGame(); /* [cite: 45] */

  }); /* [cite: 1095] */
 } else { /* [cite: 46] */ /* [cite: 1096] */
                debug("Start button not found!"); /* [cite: 46] */ /* [cite: 1097] */
            } /* [cite: 47] */
            // Restart button
            const restartButton = document.getElementById("restart-button"); /* [cite: 47] */ /* [cite: 1098] */
            if (restartButton) { /* [cite: 48] */
                restartButton.addEventListener("click", function() { /* [cite: 48] */
                    debug("Restart button clicked"); /* [cite: 48] */
                    restartGame(); /* [cite: 48] */

  }); /* [cite: 1099] */
 } /* [cite: 49] */ /* [cite: 1100] */
            // Next level button
            const nextLevelButton = document.getElementById("next-level-button"); /* [cite: 49] */ /* [cite: 1101] */
            if (nextLevelButton) { /* [cite: 50] */
                nextLevelButton.addEventListener("click", function() { /* [cite: 50] */
                    debug("Next level button clicked"); /* [cite: 50] */
                    nextLevel(); /* [cite: 50] */

  }); /* [cite: 1102] */
 } /* [cite: 51] */ /* [cite: 1103] */
            // High scores button
            const highScoresButton = document.getElementById("high-scores-button"); /* [cite: 51] */ /* [cite: 1104] */
            if (highScoresButton) { /* [cite: 52] */
                highScoresButton.addEventListener("click", function() { /* [cite: 52] */
                    debug("High scores button clicked"); /* [cite: 52] */
                    displayHighScores(); /* [cite: 52] */

  document.getElementById("high-scores").style.display = "flex"; /* [cite: 52] */ /* [cite: 1105] */
                    startScreen.style.display = "none"; /* [cite: 53] */
                }); /* [cite: 1106] */
 } /* [cite: 54] */
            // Show scores button (from game over)
            const showScoresButton = document.getElementById("show-scores-button"); /* [cite: 54] */ /* [cite: 1107] */
            if (showScoresButton) { /* [cite: 55] */
                showScoresButton.addEventListener("click", function() { /* [cite: 55] */
                    debug("Show scores button clicked"); /* [cite: 55] */
                    displayHighScores(); /* [cite: 55] */

  document.getElementById("high-scores").style.display = "flex"; /* [cite: 55] */ /* [cite: 1108] */
                    gameOverScreen.style.display = "none"; /* [cite: 56] */
                }); /* [cite: 1109] */
 } /* [cite: 57] */
            // Back button (from high scores)
            const backButton = document.getElementById("back-button"); /* [cite: 57] */ /* [cite: 1110] */
            if (backButton) { /* [cite: 58] */
                backButton.addEventListener("click", function() { /* [cite: 58] */
                    debug("Back button clicked"); /* [cite: 58] */
                    document.getElementById("high-scores").style.display = "none"; /* [cite: 58] */

  startScreen.style.display = "flex"; /* [cite: 58] */ /* [cite: 1111] */
                }); /* [cite: 59] */ /* [cite: 1112] */
            }
            // Menu button
            const menuBtn = document.getElementById("menu-btn"); /* [cite: 59] */ /* [cite: 1113] */
            const gameMenu = document.getElementById("game-menu"); /* [cite: 60] */ /* [cite: 1114] */
            if (menuBtn && gameMenu) { /* [cite: 60] */
                menuBtn.addEventListener("click", function() { /* [cite: 60] */
                    if (gameMenu.style.display === "block") { /* [cite: 60] */
                        gameMenu.style.display = "none"; /* [cite: 60] */ /* [cite: 1115] */
                    } else {
                        gameMenu.style.display = "block"; /* [cite: 61] */
                    }
                }); /* [cite: 1116] */
 // Menu items
                const toggleSoundBtn = document.getElementById("toggle-sound"); /* [cite: 62] */ /* [cite: 1117] */
                if (toggleSoundBtn) { /* [cite: 63] */
                    toggleSoundBtn.addEventListener("click", function() { /* [cite: 63] */
                        toggleSound(); /* [cite: 63] */

  gameMenu.style.display = "none"; /* [cite: 63] */ /* [cite: 1118] */
                    }); /* [cite: 1119] */
 } /* [cite: 64] */
                const toggleMusicBtn = document.getElementById("toggle-music"); /* [cite: 64] */ /* [cite: 1120] */
                if (toggleMusicBtn) { /* [cite: 65] */
                    toggleMusicBtn.addEventListener("click", function() { /* [cite: 65] */
                        toggleMusic(); /* [cite: 65] */

  gameMenu.style.display = "none"; /* [cite: 65] */ /* [cite: 1121] */
                    }); /* [cite: 1122] */
 } /* [cite: 66] */
                const showHighScores = document.getElementById("show-high-scores"); /* [cite: 66] */ /* [cite: 1123] */
                if (showHighScores) { /* [cite: 67] */
                    showHighScores.addEventListener("click", function() { /* [cite: 67] */
                        displayHighScores(); /* [cite: 67] */

  document.getElementById("high-scores").style.display = "flex"; /* [cite: 67] */ /* [cite: 1124] */
                        gameMenu.style.display = "none"; /* [cite: 68] */
                        if (gameStarted) { /* [cite: 68] */
                            togglePause(); /* [cite: 68] */ /* [cite: 1125] */
                        } /* [cite: 69] */
                    }); /* [cite: 1126] */
 } /* [cite: 70] */
                const toggleFullscreenBtn = document.getElementById("toggle-fullscreen"); /* [cite: 70] */ /* [cite: 1127] */
                if (toggleFullscreenBtn) { /* [cite: 71] */
                    toggleFullscreenBtn.addEventListener("click", function() { /* [cite: 71] */
                        toggleFullscreen(); /* [cite: 71] */

  gameMenu.style.display = "none"; /* [cite: 71] */ /* [cite: 1128] */
                    }); /* [cite: 1129] */
 } /* [cite: 72] */
                const restartFromMenu = document.getElementById("restart-from-menu"); /* [cite: 72] */ /* [cite: 1130] */
                if (restartFromMenu) { /* [cite: 73] */
                    restartFromMenu.addEventListener("click", function() { /* [cite: 73] */
                        gameMenu.style.display = "none"; /* [cite: 73] */

  if (gameStarted) { /* [cite: 73] */ /* [cite: 1131] */
                            restartGame(); /* [cite: 74] */
                        } else {
                            startGame(); /* [cite: 74] */ /* [cite: 1132] */
                        }
                    }); /* [cite: 75] */ /* [cite: 1133] */
                }
            }
            // Theme selectors
            const standardTheme = document.getElementById("standard-theme"); /* [cite: 75] */ /* [cite: 1134] */
            const neonTheme = document.getElementById("neon-theme"); /* [cite: 76] */ /* [cite: 1135] */
            const retroTheme = document.getElementById("retro-theme"); /* [cite: 76] */ /* [cite: 1136] */
            if (standardTheme && neonTheme && retroTheme) { /* [cite: 76] */
                standardTheme.addEventListener("click", function() { /* [cite: 76] */
                    setTheme('standard'); /* [cite: 76] */
                });
 neonTheme.addEventListener("click", function() { /* [cite: 77] */ /* [cite: 1137] */
                    setTheme('neon'); /* [cite: 77] */
                });
 retroTheme.addEventListener("click", function() { /* [cite: 78] */ /* [cite: 1138] */
                    setTheme('retro'); /* [cite: 78] */
                }); /* [cite: 1139] */
 } /* [cite: 79] */
        }
        // Set theme
        function setTheme(theme) {
            currentTheme = theme; /* [cite: 79] */ /* [cite: 1140] */
            document.querySelectorAll('.theme-btn').forEach(btn => { /* [cite: 80] */
                btn.classList.remove('active'); /* [cite: 80] */
            });
 document.getElementById(`${theme}-theme`).classList.add('active'); /* [cite: 81] */ /* [cite: 1141] */
            // Update the start screen background color
            if (startScreen) { /* [cite: 81] */
                startScreen.style.backgroundColor = themes[theme].screen.bg; /* [cite: 81] */ /* [cite: 1142] */
            } /* [cite: 82] */
            debug(`Theme changed to: ${theme}`); /* [cite: 82] */ /* [cite: 1143] */
        } /* [cite: 83] */
        // Handle window resize
        function handleResize() {
            // Keep the canvas centered
            if (canvas) { /* [cite: 83] */
                if (window.innerWidth < canvas.width || window.innerHeight < canvas.height) { /* [cite: 83] */

  canvas.style.width = '90vw'; /* [cite: 1144] */
                    /* [cite: 84] */ /* [cite: 1145] */
                    canvas.style.height = 'auto'; /* [cite: 84] */ /* [cite: 1146] */
                    debug("Canvas resized to fit window"); /* [cite: 84] */ /* [cite: 1147] */
                } else { /* [cite: 85] */
                    canvas.style.width = ''; /* [cite: 85] */ /* [cite: 1148] */
                    canvas.style.height = ''; /* [cite: 86] */ /* [cite: 1149] */
                }
            }
        }
        // Initialize game on page load
        window.addEventListener("load", function() { /* [cite: 86] */
            debug("Page loaded, initializing game..."); /* [cite: 86] */
            // Load high /* [cite: 1150] */
 scores
            loadHighScores(); /* [cite: 87] */
            // Initialize game elements
            if (initializeElements()) { /* [cite: 87] */
                // Create starry background
                createStars(); /* [cite: 87] */

  // Set up button listeners /* [cite: 1151] */
                setupButtonListeners(); /* [cite: 88] */
                // Set up mobile controls
                setupMobileControls(); /* [cite: 88] */
                // Add event listeners for keyboard and mouse

  document.addEventListener("keydown", keyDownHandler, false); /* [cite: 89] */ /* [cite: 1152] */
                document.addEventListener("keyup", keyUpHandler, false); /* [cite: 89] */
                document.addEventListener("mousemove", mouseMoveHandler, false); /* [cite: 89] */ /* [cite: 1153] */
                // Handle window resize
                window.addEventListener('resize', handleResize); /* [cite: 90] */ /* [cite: 1154] */
                handleResize(); /* [cite: 91] */ /* [cite: 1155] */
                // Set initial theme
                setTheme(currentTheme); /* [cite: 91] */ /* [cite: 1156] */
                debug("Game loaded and ready to start!"); /* [cite: 92] */ /* [cite: 1157] */
            } else {
                console.error("Failed to initialize game!"); /* [cite: 92] */ /* [cite: 1158] */
            } /* [cite: 93] */
        }); /* [cite: 1159] */
 // Add a fail-safe direct click handler for buttons
        document.addEventListener("click", function(e) { /* [cite: 93] */
            if (e.target && e.target.id === "start-button") { /* [cite: 93] */
                debug("Start button clicked via global handler"); /* [cite: 93] */
                startGame(); /* [cite: 93] */

  } else if (e.target && e.target.id === "restart-button") { /* [cite: 94] */ /* [cite: 1160] */
                debug("Restart button clicked via global handler"); /* [cite: 94] */
                restartGame(); /* [cite: 94] */
            } else if (e.target && e.target.id === "next-level-button") { /* [cite: 94] */
                debug("Next level /* [cite: 1161] */
 button clicked via global handler"); /* [cite: 94] */
                nextLevel(); /* [cite: 94] */
            } /* [cite: 95] */
        }); /* [cite: 1162] */

    </script>
</body>
</html>
